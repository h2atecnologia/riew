!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Riew=e()}}(function(){return function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){var f="function"==typeof require&&require;if(!a&&f)return f(o,!0);if(u)return u(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var s=r[o]={exports:{}};t[o][0].call(s.exports,function(e){return i(t[o][1][e]||e)},s,s.exports,e,t,r,n)}return r[o].exports}for(var u="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="__@@name",i="ADD_STATE",u="ADD_NODE",o="ADD_EFFECT",a="FREE",f="RESET",c="SET_NAME";var s,l,d,p=(l=[],d=function(e){var t=l.find(function(t){return t[n]===e||t.id===e});if(t)return t;throw new Error('A node with identifier "'+e+'" is missing in the grid.')},(s={}).dispatch=function(e,t){switch(e){case i:case u:case o:!function(e){if(!e||!e.id)throw new Error('Each node in the grid must be an object with "id" field. Instead "'+e+'" given.');l.push(e)}(t);break;case a:r=t,l=l.filter(function(e){return e[n]!==r&&e.id!==r});break;case f:l=[];break;case c:d(t[0].id)[n]=t[1]}var r},s.get=d,s.nodes=function(){return l},s);r.gridAdd=function(e){return p.dispatch(u,e)},r.gridAddState=function(e){return p.dispatch(i,e)},r.gridAddEffect=function(e){return p.dispatch(o,e)},r.gridFreeNode=function(e){return p.dispatch(a,e)},r.gridReset=function(){return p.dispatch(f)},r.gridSetNodeName=function(e,t){return p.dispatch(c,[e,t])},r.gridEffectQueueStep=function(e){return p.dispatch("EFFECT_QUEUE_STEP",e)},r.gridRiewRender=function(e){return p.dispatch("RIEW_RENDER",e)},r.gridGetNode=function(e){return p.get(e)},r.gridGetNodes=function(){return p.nodes()}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parallel=r.serial=r.compose=r.grid=r.react=r.riew=r.merge=r.state=void 0;var n=e("./utils");Object.defineProperty(r,"compose",{enumerable:!0,get:function(){return n.compose}}),Object.defineProperty(r,"serial",{enumerable:!0,get:function(){return n.serial}}),Object.defineProperty(r,"parallel",{enumerable:!0,get:function(){return n.parallel}});var i=e("./state"),u=f(e("./riew")),o=f(e("./react")),a=f(e("./grid"));function f(e){return e&&e.__esModule?e:{default:e}}r.state=i.createState,r.merge=i.mergeStates,r.riew=u.default,r.react={riew:o.default},r.grid=a.default},{"./grid":1,"./react":3,"./riew":4,"./state":7,"./utils":13}],3:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,u=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,u=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw u}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.default=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),f=1;f<t;f++)r[f-1]=arguments[f];return function t(){var f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=function(t){var o=(0,i.useState)(null),s=n(o,2),l=s[0],d=s[1],p=(0,i.useState)(null),y=n(p,2),v=y[0],m=y[1];return(0,i.useEffect)(function(){l&&l.update(t)},[t]),(0,i.useEffect)(function(){var n;(l=a.default.apply(void 0,[function(t){m(null===t?null:u.default.createElement(e,t))}].concat(r)),f&&f.length>0)&&(l=(n=l).with.apply(n,c(f)));return d(l),l.mount(t),function(){l.unmount()}},[]),v};return s.displayName="Riew("+(0,o.getFuncName)(e)+")",s.with=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t(r)},s}()};var i="undefined"!=typeof window?window.React:void 0!==t?t.React:null,u=f(i),o=e("../utils"),a=f(e("../riew"));function f(e){return e&&e.__esModule?e:{default:e}}function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../riew":4,"../utils":13}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(r,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,u=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,u=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw u}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)};r.default=function e(t){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var p={id:(0,c.getId)("r"),name:(0,c.getFuncName)(t)};var y=!1;var v=[];var m=[];var h=[];var g={};var b=(0,a.createState)({}),_=i(b,1),w=_[0];var A=(0,a.createState)({}),E=i(A,1),S=E[0];var O=(0,a.createState)({}),j=i(O,1),P=j[0];var T=function(){return y};var x=S.mutate(function(e,t){var r=u({},e);return t&&Object.keys(t).forEach(function(e){if((0,a.isRiewQueueEffect)(t[e])&&!t[e].isMutating()){var n=t[e];r[e]=n(),i=n.state,m.find(function(e){return e.state.id===i.id})||m.push(n.pipe(function(){return M(s({},e,n()))}).subscribe())}else r[e]=t[e];var i}),r});var M=x.filter(T).pipe(function(e){t(e),(0,f.gridRiewRender)([p,e])});var N=P.mutate(d);var R=w.mutate(d);N({state:function(){var e=a.createState.apply(void 0,arguments);return v.push(e),e},render:function(e){return l(e,"The `render` method"),M(e)},isActive:T,props:w});function C(){Object.keys(g).forEach(function(e){var t=void 0;"@"===e.charAt(0)?(e=e.substr(1,e.length),t=(0,f.gridGetNode)(e)):t=g[e],x(s({},e,t)),N(s({},e,t))})}p.isActive=T;p.mount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(e,"The `mount` method"),R(e),x(e),C();var t=c.parallel.apply(void 0,n)(P()),r=function(e){return h=e||[]};return(0,c.isPromise)(t)?t.then(r):r(t),y=!0,M(),p};p.update=function(e){M(e),R(e)};p.unmount=function(){return y=!1,S.teardown(),P.teardown(),v.forEach(function(e){return e.teardown()}),v=[],h.filter(function(e){return"function"==typeof e}).forEach(function(e){return e()}),h=[],m.forEach(function(e){return e.unsubscribe()}),m=[],p};p.__setExternals=function(e){g=u({},g,e.reduce(function(e,t){return e=u({},e,"string"==typeof t?s({},"@"+t,!0):t)},{}))};p.with=function(){for(var r=arguments.length,i=Array(r),u=0;u<r;u++)i[u]=arguments[u];var o=e.apply(void 0,[t].concat(n));return o.__setExternals(i),o};p.test=function(r){var i=e.apply(void 0,[t].concat(n));return i.__setExternals([r]),i};return p};var a=e("./state"),f=e("./grid"),c=e("./utils");function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){if(null===e||void 0!==e&&"object"!==(void 0===e?"undefined":o(e)))throw new Error(t+' must be called with a key-value object. Instead "'+e+'" passed.');return e}var d=function(e,t){return u({},e,t)}},{"./grid":1,"./state":7,"./utils":13}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.implementIterable=void 0,r.default=function(e){var t=[],r={},l=[],y=!0;function v(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=void 0,a=function t(){if(!y||0===t.__itemsToCreate.length)return e.get();var n=(0,s.default)(e.set,e.get,function(){t.__queues=t.__queues.filter(function(e){var t=e.id;return n.id!==t})},function(e){(0,i.gridEffectQueueStep)([t,e])},r);return t.__queues.push(n),t.__itemsToCreate.forEach(function(e){var t=e.type,r=e.func;return n.add(t,r)}),n.process.apply(n,arguments)};return l.push(a),p(a),a.id=(0,n.getId)("e"),a.state=e,a.__queues=[],a.__riewEffect=!0,a.__itemsToCreate=[].concat(d(u)),a.__listeners=e.listeners,t.forEach(function(e){a[e]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return v([].concat(d(a.__itemsToCreate),[{type:e,func:r}]))}}),a.define=function(e,t){return m(e,t),a},a.isMutating=function(){return!!a.__itemsToCreate.find(function(e){return"mutate"===e.type})},a.subscribe=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(a.isMutating())throw new Error("You should not subscribe a effect that mutates the state. This will lead to endless recursion.");return t&&a(),e.addListener(a),a},a.unsubscribe=function(){return e.removeListener(a),a},a.cancel=function(){return a.__queues.forEach(function(e){return e.cancel()}),a},a.cleanUp=function(){a.cancel(),a.unsubscribe(),o&&(0,i.gridFreeNode)(o)},a.teardown=function(){return y=!1,e.teardown(),l.forEach(function(e){return e.cleanUp()}),l=[a],a},a.export=function(e){return o&&(0,i.gridFreeNode)(o),(0,i.gridAddEffect)(a),(0,i.gridSetNodeName)(a,o=e),a},a.isActive=function(){return y},a.test=function(e){var t=v([].concat(d(a.__itemsToCreate))),r={setValue:function(e){t.__itemsToCreate=[{type:"map",func:[function(){return e}]}].concat(d(t.__itemsToCreate))},swap:function(e,r,n){Array.isArray(r)||(r=[r]),t.__itemsToCreate[e].func=r,n&&(t.__itemsToCreate[e].type=n)},swapFirst:function(e,t){r.swap(0,e,t)},swapLast:function(e,n){r.swap(t.__itemsToCreate.length-1,e,n)}};return e(r),t},a}function m(e,i){t.push(e),r[e]=function(e,t,r,u){var o=i.apply(void 0,d(t))(e.result,r,u,e);return(0,n.isPromise)(o)?o.then(u):u(o)},l.forEach(function(t){t[e]=function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return v([].concat(d(t.__itemsToCreate),[{type:e,func:n}]))}})}return m("pipe",u.default),m("map",o.default),m("mapToKey",a.default),m("mutate",f.default),m("filter",c.default),v};var n=e("../utils"),i=e("../grid"),u=l(e("./pipe")),o=l(e("./map")),a=l(e("./mapToKey")),f=l(e("./mutate")),c=l(e("./filter")),s=l(e("./queue"));function l(e){return e&&e.__esModule?e:{default:e}}function d(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var p=r.implementIterable=function(e){"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&(e[Symbol.iterator]=function(){var t=[e.map(),e.mutate(),e],r=0;return{next:function(){return{value:t[r++],done:r>t.length}}}})}},{"../grid":1,"../utils":13,"./filter":6,"./map":8,"./mapToKey":9,"./mutate":10,"./pipe":11,"./queue":12}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,i,u){var o=e.apply(void 0,[t].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r)));return(0,n.isPromise)(o)?o.then(function(e){return e||(u.index=u.items.length),i(t)}):(o||(u.index=u.items.length),i(t))}};var n=e("../utils")},{"../utils":13}],7:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(r,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)},u=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,u=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,u=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw u}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.createState=l,r.mergeStates=function(e){var t=l();return t.state.get=function(){return Object.keys(e).reduce(function(t,r){var n=u(e[r],1)[0];return t[r]=n(),t},{})},t.state.set=function(t){if("object"!==(void 0===t?"undefined":i(t)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(t).forEach(function(r){if(!e[r])throw new Error('There is no state with key "'+r+'".');var n=u(e[r],2),i=n[0],a=n[1];(0,o.default)(t[r],i())||a(t[r])},{})},Object.keys(e).forEach(function(r){e[r].pipe(t.state.triggerListeners).subscribe()}),t},r.isRiewQueueEffect=function(e){return e&&!0===e.__riewEffect};var o=s(e("fast-deep-equal")),a=s(e("./effect")),f=e("../utils"),c=e("../grid");function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return(0,a.default)(function(e){var t={},r=e,n=[];return t.id=(0,f.getId)("s"),t.triggerListeners=function(){n.forEach(function(e){return e()})},t.get=function(){return r},t.set=function(e){var n=(0,o.default)(r,e);r=e,n||t.triggerListeners()},t.teardown=function(){n=[],(0,c.gridFreeNode)(t.id)},t.listeners=function(){return n},t.addListener=function(e){n.push(e)},t.removeListener=function(e){n=n.filter(function(t){return t.id!==e.id})},(0,c.gridAddState)(t),t}(e))()}},{"../grid":1,"../utils":13,"./effect":5,"fast-deep-equal":14}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,i){var u=(e||function(e){return e}).apply(void 0,[t].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r)));return(0,n.isPromise)(u)?u.then(i):i(u)}};var n=e("../utils")},{"../utils":13}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,n){return n(function(t){return function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}({},e,t)}.apply(void 0,[t].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r))))}}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,i,u){var o=(e||function(e,t){return t}).apply(void 0,[t].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r)));return(0,n.isPromise)(o)?o.then(function(e){return u.setStateValue(e),i(e)}):(u.setStateValue(o),i(o))}};var n=e("../utils")},{"../utils":13}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,i){var u=(e||function(){}).apply(void 0,[t].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r)));return(0,n.isPromise)(u)?u.then(function(){return i(t)}):i(t)}};var n=e("../utils")},{"../utils":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},u=arguments[4],o={id:(0,n.getId)("q"),index:0,setStateValue:e,getStateValue:t,result:t(),items:[],add:function(e,t){this.items.push({type:e,func:t,name:t.map(n.getFuncName)})},process:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];function a(e){return o.result=e,o.index++,o.index<o.items.length?f():(r(),o.result)}function f(){var e=o.items[o.index],r=e.type,n=e.func,f=u[r];if(f){var c=f(o,n,t,a);return i(o),c}throw new Error('Unsupported method "'+r+'".')}return o.index=0,o.items.length>0?f():o.result},cancel:function(){o.items=[]}};return o};var n=e("../utils")},{"../utils":13}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=r.isPromise=function(e){return e&&"function"==typeof e.then},i=(r.isObjectLiteral=function(e){return!!e&&e.constructor==={}.constructor},r.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"},r.compose=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,i=function(){},u=[].concat(t);return function t(){if(0!==u.length){var o=u.shift()(e);n(o)?(r=!0,o.then(function(r){e=r,t()})):(e=o,t())}else i(e)}(),r?new Promise(function(e){return i=e}):e}},r.serial=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,i=function(){},u=[],o=[].concat(t);return function t(){if(0!==o.length){var a=o.shift()(e);n(a)?(r=!0,a.then(function(e){u.push(e),t()})):(u.push(a),t())}else i(u)}(),r?new Promise(function(e){return i=e}):u}},r.parallel=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,i=[],u=[].concat(t);return function t(){if(0!==u.length){var o=u.shift()(e);n(o)&&(r=!0),i.push(o),t()}}(),r?Promise.all(i.map(function(e){return n(e)?e:Promise.resolve(e)})):i}},0);r.getId=function(e){return"@@"+e+ ++i}},{}],14:[function(e,t,r){"use strict";var n=Array.isArray,i=Object.keys,u=Object.prototype.hasOwnProperty;t.exports=function e(t,r){if(t===r)return!0;var o,a,f,c=n(t),s=n(r);if(c&&s){if((a=t.length)!=r.length)return!1;for(o=0;o<a;o++)if(!e(t[o],r[o]))return!1;return!0}if(c!=s)return!1;var l=t instanceof Date,d=r instanceof Date;if(l!=d)return!1;if(l&&d)return t.getTime()==r.getTime();var p=t instanceof RegExp,y=r instanceof RegExp;if(p!=y)return!1;if(p&&y)return t.toString()==r.toString();if(t instanceof Object&&r instanceof Object){var v=i(t);if((a=v.length)!==i(r).length)return!1;for(o=0;o<a;o++)if(!u.call(r,v[o]))return!1;for(o=0;o<a;o++)if(!e(t[f=v[o]],r[f]))return!1;return!0}return!1}},{}]},{},[2])(2)});