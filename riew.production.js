!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Riew=t()}}(function(){return function u(i,a,c){function f(e,t){if(!a[e]){if(!i[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(s)return s(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[e]={exports:{}};i[e][0].call(o.exports,function(t){return f(i[e][1][t]||t)},o,o.exports,u,i,a,c)}return a[e].exports}for(var s="function"==typeof require&&require,t=0;t<c.length;t++)f(c[t]);return f}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.riew=n.merge=n.state=void 0;var r=t("./state"),o=i(t("./riew")),u=i(t("./react"));function i(t){return t&&t.__esModule?t:{default:t}}n.state=r.createState,n.merge=r.mergeStates,n.riew=o.default,n.react={riew:u.default}},{"./react":2,"./riew":3,"./state":4}],2:[function(r,t,u){(function(t){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var y=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,u=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,u=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};u.default=function(l){var d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:n;return function e(t,n){function r(t){var e=(0,p.useState)(null),n=y(e,2),r=n[0],o=n[1],u=(0,p.useState)({content:null,done:function(){}}),i=y(u,2),a=i[0],c=i[1];return(0,p.useEffect)(function(){r&&r.update(t)},[t]),(0,p.useEffect)(function(){r&&a.done()},[a]),(0,p.useEffect)(function(){return r=(0,m.default)(function(t,e){c(null===t?{content:null,done:e}:{content:v.default.createElement(l,t),done:e})},d),null!==f&&(r=r.with(f)),null!==s&&(r=r.withState(s)),o(r),r.in(t),function(){r.out()}},[]),a.content}var f=0<arguments.length&&void 0!==t?t:null,s=1<arguments.length&&void 0!==n?n:null;return r.displayName="Riew("+(0,o.getFuncName)(d)+")",r.with=function(t){return e(t)},r.withState=function(t){return e(null,t)},r}(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{})};var p="undefined"!=typeof window?window.React:void 0!==t?t.React:null,v=e(p),o=r("../utils"),m=e(r("../riew"));function e(t){return t&&t.__esModule?t:{default:t}}var n=function(){}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../riew":3,"../utils":5}],3:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0});var g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},w="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)};n.default=function e(r){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:S;var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};var n={};var u=!1;var a=[];var c=S;var f=function(){return u};var s=(0,b.createState)({});var l=s.mutate(function(t,e){return g({},t,e)});var d=(0,b.createState)({});var y=d.mutate(function(t,e){return g({},t,e)});var p=(0,b.createState)({render:function(e){return E(e,"render"),u?new Promise(function(t){c=t,y(e)}):Promise.resolve()},props:s,isActive:f});var v=p.mutate(function(t,e){return g({},t,e)});function m(){r(d.get(),c),c=S}function h(){Object.keys(i).forEach(function(e){var t=(0,b.isRiewState)(i[e]),n=(0,b.isRiewQueueTrigger)(i[e]),r=void 0;if(t)r=i[e],v(_({},e,r)),y(_({},e,r.get())),r.stream.pipe(function(t){return y(_({},e,t))});else if(n){var o=i[e];if(o.__activity()===b.MUTABLE)throw new Error("Triggers that mutate state can not be sent to the riew. This area is meant only for triggers that fetch data. If you need to pass such triggers use the controller to do that.");o.__state.stream.filter(f).pipe(function(){return y(_({},e,o()))})()}else if("$"===e.charAt(0)){var u=e.substr(1,e.length);r=(0,b.createState)(i[e]),a.push(r.teardown),v(_({},u,r)),y(_({},u,r.get())),r.stream.filter(f).pipe(function(t){return y(_({},u,t))})}else v(_({},e,i[e])),y(_({},e,i[e]))})}n.isActive=f;n.in=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u=!0,E(t,"in"),l(t),h();var e=o(p.get());if(e){if("object"!==(void 0===e?"undefined":w(e)))throw new Error("You must return a key-value object from your controller.");y(e)}return s.stream(),d.stream.pipe(m)(),n};n.update=l;n.out=function(){return a.forEach(function(t){return t()}),a=[],s.teardown(),d.teardown(),p.teardown(),u=!1,n};n.with=function(t){return e(r,o,g({},i,t))};n.withState=function(n){return e(r,o,Object.keys(n).reduce(function(t,e){return t["$"+e]=n[e],t},i))};n.test=function(t){return e(r,o,g({},i,t))};return n};var b=t("./state");function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S(){}function E(t,e){if(null===t||void 0!==t&&"object"!==(void 0===t?"undefined":w(t)))throw new Error("The riew's \""+e+'" method must be called with a key-value object. Instead "'+t+'" passed.')}},{"./state":4}],4:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.MUTABLE=n.IMMUTABLE=void 0;var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)};n.createState=c,n.mergeStates=function(n){function t(){return Object.keys(n).reduce(function(t,e){return t[e]=n[e].get(),t},{})}var r=c(t());return r.set=function(e){if("object"!==(void 0===e?"undefined":o(e)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(e).forEach(function(t){n[t].set(e[t],!1)}),r.__triggerListeners()},r.get=t,Object.keys(n).forEach(function(t){n[t].stream.pipe(function(){r.__triggerListeners()})}),r},n.createStream=function(t){return c(t).stream},n.isRiewState=function(t){return t&&!0===t.__riew},n.isRiewQueueTrigger=function(t){return t&&!0===t.__riewTrigger};var d=t("./utils");function p(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var i=n.IMMUTABLE="IMMUTABLE",a=n.MUTABLE="MUTABLE",u=0,v=function(t){return"@@"+t+ ++u},m=["pipe","map","mutate","filter","parallel","cancel","mapToKey"],h=function(t){var e=!0,n=!1,r=void 0;try{for(var o,u=t[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){if("mutate"===o.value.type)return a}}catch(t){n=!0,r=t}finally{try{!e&&u.return&&u.return()}finally{if(n)throw r}}return i};function g(s,t,e){var r=2<arguments.length&&void 0!==e?e:function(){},l={index:0,result:t(),id:v("q"),items:[],add:function(t,e){this.items.push({type:t,func:e,name:e.map(d.getFuncName)})},process:function(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];var a=l.items,c=function(){return l.items=[]};function f(){return l.index++,l.index<a.length?n():(r(l),l.result)}function n(){var t=a[l.index],e=t.type,n=t.func;switch(e){case"pipe":var r=(n[0]||function(){}).apply(void 0,[l.result].concat(i));return(0,d.isPromise)(r)?r.then(f):f();case"map":return l.result=(n[0]||function(t){return t}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(t){return l.result=t,f()}):f();case"mapToKey":return l.result=function(t){return function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},n[0],t)}.apply(void 0,[l.result].concat(i)),f();case"mutate":return l.result=(n[0]||function(t,e){return e}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(t){return l.result=t,s(l.result),f()}):(s(l.result),f());case"filter":var o=n[0].apply(n,[l.result].concat(i));return(0,d.isPromise)(o)?o.then(function(t){return t||(l.index=a.length),f()}):(o||(l.index=a.length),f());case"parallel":l.result=n.map(function(t){return t.apply(void 0,[l.result].concat(i))});var u=l.result.filter(d.isPromise);return 0<u.length?Promise.all(u).then(function(){return l.result.forEach(function(t,e){(0,d.isPromise)(t)&&t.then(function(t){return l.result[e]=t})}),f()}):f();case"cancel":return l.index=-1,c(),l.result}throw new Error('Unsupported method "'+e+'".')}return(l.index=0)<a.length?n():l.result},cancel:function(){this.items=[]}};return l}function c(t){var e=t,c={},f=[],s=[],l=!0;function d(){return function(){0<arguments.length?c.set(arguments.length<=0?void 0:arguments[0]):c.__triggerListeners()}}function y(t,e,n){function o(){if(!1===l)return c.get();var r=g(c.set,c.get,function(n){return f=f.filter(function(t){var e=t.id;return n.id!==e})});return f.push(r),o.__itemsToCreate.forEach(function(t){var e=t.type,n=t.func;return r.add(e,n)}),r.process.apply(r,arguments)}function r(t,o,u){m.forEach(function(r){t[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return y([].concat(p(i),[{type:r,func:e}]),u,o)}})}var i=0<arguments.length&&void 0!==t?t:[],u=e,a=2<arguments.length&&void 0!==n?n:null;return o.id=v("t"),o.stream=d(),o.__riewTrigger=!0,o.__itemsToCreate=[].concat(p(i)),o.__state=c,o.__activity=function(){return h(o.__itemsToCreate)},r(o,o,u),r(o.stream,o,!0),["set","get","teardown"].forEach(function(t){o[t]=function(){throw new Error('"'+t+'" is not a queue method but a method of the state object.')}}),o.test=function(t){var r=y([].concat(p(i)),u,o),n={setValue:function(t){r.__itemsToCreate=[{type:"map",func:[function(){return t}]}].concat(p(r.__itemsToCreate))},swap:function(t,e,n){Array.isArray(e)||(e=[e]),r.__itemsToCreate[t].func=e,n&&(r.__itemsToCreate[t].type=n)},swapFirst:function(t,e){n.swap(0,t,e)},swapLast:function(t,e){n.swap(r.__itemsToCreate.length-1,t,e)}};return t(n),r},u&&(s.push(o),a&&function(t){var e=t.id;s=s.filter(function(t){return t.id!==e})}(a)),o}function n(t,o){m.forEach(function(r){t[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return y([{type:r,func:e}],o)}})}return c.id=v("s"),c.__riew=!0,c.__triggerListeners=function(){return s.forEach(function(t){return t()})},c.__listeners=function(){return s},c.__queues=function(){return f},c.active=function(){return l},c.get=function(){return e},c.set=function(t){e=t,1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||c.__triggerListeners()},c.teardown=function(){f.forEach(function(t){return t.cancel()}),f=[],l=!(s=[])},c.stream=d(),n(c),n(c.stream,!0),c}},{"./utils":5}],5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isPromise=function(t){return t&&"function"==typeof t.then},n.getFuncName=function(t){if(t.name)return t.name;var e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:"unknown"}},{}]},{},[1])(1)});