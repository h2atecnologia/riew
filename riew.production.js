!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Riew=e()}}(function(){return function e(n,t,r){function o(i,a){if(!t[i]){if(!n[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(u)return u(i,!0);var f=new Error("Cannot find module '"+i+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){return o(n[i][1][e]||e)},l,l.exports,e,n,t,r)}return t[i].exports}for(var u="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=(0,u.default)();return e.setValue=function(n){return e.value=n},e.put=function(n,t){e.value=[n],t(!0)},e.take=function(n){n(e.value[0])},e};var r,o=e("./Interface"),u=(r=o)&&r.__esModule?r:{default:r}},{"./Interface":4}],2:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=(0,u.default)();return t.setValue=function(e){return t.value=e},t.put=function(r,o){var u=!0;t.value.length<e?t.value.push(r):n?(t.value.shift(),t.value.push(r)):u=!1,t.takes.length>0&&t.takes.shift()(t.value.shift()),o(u)},t.take=function(e){0===t.value.length?t.takes.push(e):e(t.value.shift())},t};var r,o=e("./Interface"),u=(r=o)&&r.__esModule?r:{default:r}},{"./Interface":4}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=(0,u.default)();return n.setValue=function(e){return n.value=e},n.put=function(t,r){0===n.takes.length?n.value.length<e?(n.value.push(t),r(!0)):n.puts.push({callback:function(e){n.value.push(t),n.takes.length>0&&n.takes.shift()(n.value.shift()),r(e||!0)},item:t}):(n.value.push(t),n.takes.shift()(n.value.shift()),r(!0))},n.take=function(t){if(0===n.value.length)n.puts.length>0?(n.puts.shift().callback(),n.take(t)):n.takes.push(t);else{var r=n.value.shift();n.value.length<e&&n.puts.length>0&&n.puts.shift().callback(),t(r)}},n};var r,o=e("./Interface"),u=(r=o)&&r.__esModule?r:{default:r}},{"./Interface":4}],4:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{value:[],puts:[],takes:[],isEmpty:function(){return 0===this.value.length},reset:function(){this.value=[],this.puts=[],this.takes=[]},setValue:function(e){this.value=e},getValue:function(){return this.value}}}},{}],5:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(e("./FixedBuffer")),o=i(e("./DroppingBuffer")),u=i(e("./DivorcedBuffer"));function i(e){return e&&e.__esModule?e:{default:e}}var a={fixed:r.default,dropping:o.default,sliding:function(e){return(0,o.default)(e,!0)},divorced:u.default};t.default=a},{"./DivorcedBuffer":1,"./DroppingBuffer":2,"./FixedBuffer":3}],6:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};t.createChannel=function(){for(var e=c.OPEN,n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];var i=function(e){var n=void 0,t=void 0;2===e.length?(n=e[0],t=e[1]):1===e.length&&"string"==typeof e[0]?(n=e[0],t=s.default.fixed()):1===e.length&&"object"===u(e[0])?(n=(0,a.getId)("ch"),t=e[0]):(n=(0,a.getId)("ch"),t=s.default.fixed());return[n,t]}(t),l=o(i,2),d=l[0],p=l[1];if(f.CHANNELS.exists(d))return[f.CHANNELS.get(d),!0];var v=f.CHANNELS.set(d,{id:d,"@channel":!0,subscribers:[]});return v.isActive=function(){return v.state()===c.OPEN},v.buff=p,v.state=function(n){return void 0!==n&&(e=n),e},v.value=function(){return p.getValue()},[v,!1]};var i,a=e("../utils"),c=e("./constants"),f=e("../index"),l=e("./buffer"),s=(i=l)&&i.__esModule?i:{default:i}},{"../index":14,"../utils":21,"./buffer":5,"./constants":7}],7:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OPEN=Symbol("OPEN"),t.CLOSED=Symbol("CLOSED"),t.ENDED=Symbol("ENDED"),t.PUT="PUT",t.TAKE="TAKE",t.NOOP="NOOP",t.SLEEP="SLEEP",t.STOP="STOP",t.READ="READ",t.CALL_ROUTINE="CALL_ROUTINE",t.FORK_ROUTINE="FORK_ROUTINE",t.NOTHING=Symbol("NOTHING"),t.ALL_REQUIRED=Symbol("ALL_REQUIRED"),t.ONE_OF=Symbol("ONE_OF"),t.CHANNELS={channels:{},getAll:function(){return this.channels},get:function(e){return this.channels[e]},set:function(e,n){return this.channels[e]=n,n},del:function(e){delete this.channels[e]},exists:function(e){return!!this.channels[e]},reset:function(){this.channels={}}}},{}],8:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./buffer");Object.defineProperty(t,"buffer",{enumerable:!0,get:function(){return(e=r,e&&e.__esModule?e:{default:e}).default;var e}});var o=e("./channel");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=e("./ops");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var i=e("./state");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=e("./constants");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},{"./buffer":5,"./channel":6,"./constants":7,"./ops":9,"./state":10}],9:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStateWriteChannel=t.isStateReadChannel=t.isState=t.isRiew=t.isChannel=void 0;var r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};t.put=function(e,n){return{channels:e,op:o.PUT,item:n}},t.sput=l,t.take=function(e,n){return{channels:e,op:o.TAKE,options:n}},t.stake=s,t.read=function(e,n){return{channels:e,op:o.READ,options:r({},n,{read:!0})}},t.sread=d,t.unread=function(e,n){(e=(0,a.normalizeChannels)(e)).forEach(function(e){h(n)&&(n=n.__subFunc),e.subscribers=e.subscribers.filter(function(e){return e.callback!==n})})},t.unreadAll=function(e){(0,a.normalizeChannels)(e).forEach(function(e){e.subscribers=[]})},t.close=p,t.sclose=function(e){return p(e)},t.channelReset=v,t.schannelReset=function(e){v(e)},t.call=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return{op:o.CALL_ROUTINE,routine:e,args:t}},t.fork=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return{op:o.FORK_ROUTINE,routine:e,args:t}},t.merge=function(){for(var e=(0,u.chan)(),n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return t.forEach(function(n){!function t(){s(n,function(n){n!==o.CLOSED&&n!==o.ENDED&&e.state()===o.OPEN&&l(e,n,t)})}()}),e},t.timeout=function(e){var n=(0,u.chan)();return setTimeout(function(){return p(n)},e),n},t.runRoutine=function(e){for(var n=arguments.length,t=Array(n>2?n-2:0),r=2;r<n;r++)t[r-2]=arguments[r];var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},f="STOPPED",p="RUNNING",v={id:"routine_"+(0,i.getId)(),children:[],stop:function(){p=f,this.children.forEach(function(e){return e.stop()})},rerun:function(){y=e.apply(void 0,t),g()}},h=function(e){return v.children.push(e)},y=e.apply(void 0,t);function b(e){switch(e.value.op){case o.PUT:l(e.value.channels,e.value.item,g);break;case o.TAKE:s(e.value.channels,function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];g(1===n.length?n[0]:n)},e.value.options);break;case o.NOOP:g();break;case o.SLEEP:setTimeout(g,e.value.ms);break;case o.STOP:p=f;break;case o.READ:d(e.value.channels,g,e.value.options);break;case o.CALL_ROUTINE:h(u.go.apply(void 0,[e.value.routine,g].concat(c(e.value.args))));break;case o.FORK_ROUTINE:h(u.go.apply(void 0,[e.value.routine,function(){}].concat(c(e.value.args)))),g();break;default:throw new Error("Unrecognized operation "+e.value.op+" for a routine.")}}function g(e){if(p!==f){var n=y.next(e);!0===n.done?(a&&a(n.value),n.value&&!0===n.value["@go"]&&v.rerun()):(0,i.isPromise)(n.value)?n.value.then(g).catch(function(e){return b(y.throw(e))}):b(n)}}return g(),v},t.sleep=function(e,n){if("function"!=typeof n)return{op:o.SLEEP,ms:e};setTimeout(n,e)},t.stop=function(){return{op:o.STOP}};var o=e("./constants"),u=e("../index"),i=e("../utils"),a=e("./utils");function c(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}var f=function(){};function l(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f,r=(e=(0,a.normalizeChannels)(e,"WRITE")).map(function(){return o.NOTHING}),u=e.length>1?n:[n];e.forEach(function(e,n){var i=e.state();i===o.CLOSED||i===o.ENDED?t(i):function(e,n,t){var r=e.subscribers.map(function(){return 1});if(0===r.length)return t();var o=[].concat(c(e.subscribers));e.subscribers=[],o.forEach(function(o){var u=o.notify;o.listen&&e.subscribers.push(o),u(n,function(){r.shift(),0===r.length&&t()})})}(e,u[n],function(){e.buff.put(u[n],function(e){r[n]=e,r.includes(o.NOTHING)||t(1===r.length?r[0]:r)})})})}function s(e,n,t){e=(0,a.normalizeChannels)(e),t=(0,a.normalizeOptions)(t);var r=e.map(function(){return o.NOTHING}),l=t,s=l.transform,d=l.onError,p=l.initialCall,v=l.listen,h=function(e,a){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;r[a]=e;var p=null;if(t.strategy===o.ONE_OF?p=[e,a]:r.includes(o.NOTHING)||(p=[].concat(c(r))),null!==p)if(s)try{(0,i.isGeneratorFunction)(s)?u.go.apply(void 0,[s,function(e){return n(e),l()}].concat(c(p))):(n(s.apply(void 0,c(p))),l())}catch(e){if(null===d)throw e;d(e)}else t.strategy===o.ONE_OF?n.apply(void 0,c(p)):n(1===p.length?p[0]:p),l()},y=e.map(function(e,r){var u=e.state(),i={};if(u===o.ENDED)h(o.ENDED,r);else if(u===o.CLOSED&&e.buff.isEmpty())e.state(o.ENDED),h(o.ENDED,r);else if(t.read){e.subscribers.find(function(e){return e.callback===n})||e.subscribers.push(i={callback:n,notify:function(e,n){return h(e,r,n)},listen:v});var a=e.value();p&&a.length>0&&h(a[0],r)}else e.buff.take(function(e){return h(e,r)});return i});return{listen:function(){y.forEach(function(e){return e.listen=!0})}}}function d(e,n,t){return s(e,(0,a.normalizeTo)(n),r({},t,{read:!0}))}function p(e){return(e=(0,a.normalizeChannels)(e)).forEach(function(e){var n=e.buff.isEmpty()?o.ENDED:o.CLOSED;e.state(n),e.buff.puts.forEach(function(e){return e.callback(n)}),e.buff.takes.forEach(function(e){return e(n)}),u.grid.remove(e),e.subscribers=[],o.CHANNELS.del(e.id)}),{op:o.NOOP}}function v(e){return(e=(0,a.normalizeChannels)(e)).forEach(function(e){e.state(o.OPEN),e.buff.reset()}),{op:o.NOOP}}var h=t.isChannel=function(e){return e&&!0===e["@channel"]};t.isRiew=function(e){return e&&!0===e["@riew"]},t.isState=function(e){return e&&!0===e["@state"]},t.isStateReadChannel=function(e){return e&&!0===e["@statereadchannel"]},t.isStateWriteChannel=function(e){return e&&!0===e["@statewritechannel"]}},{"../index":14,"../utils":21,"./constants":7,"./utils":11}],10:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createState=function(){var e=arguments.length<=0?void 0:arguments[0],n=(0,o.getId)("state"),t=[],u=[],i=arguments.length>0;function a(e){return function(n){if(null===e)throw n;e(n)}}function c(n,t){var u=n.ch,i=n.selector,c=n.onError;try{if((0,o.isGeneratorFunction)(i))return void(0,r.go)(i,function(e){return(0,r.sput)(u,e)},e);(0,r.sput)(u,i(t))}catch(e){a(c)(e)}}var f={id:n,"@state":!0,children:function(){return t.map(function(e){return e.ch}).concat(u.map(function(e){return e.ch}))},READ:n+"_read",WRITE:n+"_write",select:function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=(0,r.isChannel)(n)?n:(0,r.chan)(n,r.buffer.divorced());a["@statereadchannel"]=!0;var f={ch:a,selector:o,onError:u};return t.push(f),i&&c(f,e),this},mutate:function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,n){return n},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=(0,r.isChannel)(n)?n:(0,r.chan)(n,r.buffer.divorced());l["@statewritechannel"]=!0;var s={ch:l};return u.push(s),(0,r.sread)(l,function(n){e=n,t.forEach(function(n){return c(n,e)})},{transform:regeneratorRuntime.mark(function n(t){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!(0,o.isGeneratorFunction)(i)){n.next=5;break}return n.next=4,(0,r.call)(i,e,t);case 4:return n.abrupt("return",n.sent);case 5:return n.abrupt("return",i(e,t));case 8:n.prev=8,n.t0=n.catch(0),a(f)(n.t0);case 11:case"end":return n.stop()}},n,this,[[0,8]])}),onError:a(f),initialCall:!0,listen:!0}),this},destroy:function(){return t.forEach(function(e){var n=e.ch;return(0,r.sclose)(n)}),u.forEach(function(e){var n=e.ch;return(0,r.sclose)(n)}),e=void 0,r.grid.remove(f),this},get:function(){return e},set:function(n){return e=n,t.forEach(function(n){c(n,e)}),n}};return f.select(f.READ),f.mutate(f.WRITE),f};var r=e("../index"),o=e("../utils")},{"../index":14,"../utils":21}],11:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeChannels=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"READ";Array.isArray(e)||(e=[e]);return e.map(function(e){return(0,r.isState)(e)&&(e=e[n]),(0,r.isChannel)(e)?e:(0,r.chan)(e)})},t.normalizeTo=function(e){if("function"==typeof e)return e;if((0,r.isChannel)(e))return e.__subFunc||(e.__subFunc=function(n){return(0,r.sput)(e,n)});if("string"==typeof e){return(0,r.chan)(e,r.buffer.divorced()).__subFunc=function(n){return(0,r.sput)(e,n)}}throw new Error("'read' accepts string, channel or a function as a second argument. "+e+" given.")},t.normalizeOptions=function(e){var n=(e=e||u).transform||u.transform,t=e.onError||u.onError,r=e.strategy||o.ALL_REQUIRED,i="listen"in e&&e.listen,a="read"in e&&e.read,c="initialCall"in e?e.initialCall:u.initialCall;return{transform:n,onError:t,strategy:r,initialCall:c,listen:i,read:a}};var r=e("../index"),o=e("./constants");var u={transform:null,onError:null,initialCall:!0}},{"../index":14,"./constants":7}],12:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var n={},t=[];return n.add=function(n){if(!n||!n.id)throw new Error('Each node in the grid must be an object with "id" field. Instead "'+n+'" given.');t.push(n),e.snapshot()},n.remove=function(n){var r=t.findIndex(function(e){return e.id===n.id});r>=0&&t.splice(r,1),e.snapshot()},n.reset=function(){t=[]},n.nodes=function(){return t},n.getNodeById=function(e){return t.find(function(n){return n.id===e})},n}},{}],13:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=c(e("./riew")),u=c(e("./react")),i=e("./index"),a=e("./csp");function c(e){return e&&e.__esModule?e:{default:e}}var f,l,s=function(e){e.defineProduct("riew",function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var u=o.default.apply(void 0,[e].concat(t));return i.grid.add(u),u}),e.defineProduct("reactRiew",function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return u.default.apply(void 0,[e].concat(t))}),e.defineProduct("channel",function(){var e=a.createChannel.apply(void 0,arguments),n=r(e,2),t=n[0],o=n[1];return o||i.grid.add(t),t}),e.defineProduct("state",function(){var e=a.createState.apply(void 0,arguments);return i.grid.add(e),e}),e.defineProduct("routine",function(){var e=a.runRoutine.apply(void 0,arguments);return i.grid.add(e),e})},d=(l={},(f={}).defineProduct=function(e,n){if(l[e])throw new Error('A product with type "'+e+'" already exists.');l[e]=n},f.undefineProduct=function(e){if(!l[e])throw new Error('There is no product with type "'+e+'" to be removed.');delete l[e]},f.produce=function(e){for(var n,t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];if(!l[e])throw new Error('There is no product with type "'+e+'".');return(n=l)[e].apply(n,r)},f.reset=function(){l={},s(f)},f.debug=function(){return{productNames:Object.keys(l)}},f);s(d),t.default=d},{"./csp":8,"./index":14,"./react":16,"./riew":17}],14:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.harvester=t.reset=t.grid=t.logger=t.register=t.use=t.go=t.state=t.chan=t.react=t.riew=void 0;var o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},i=e("./csp");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=l(e("./harvester")),c=l(e("./grid")),f=l(e("./logger"));function l(e){return e&&e.__esModule?e:{default:e}}function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}t.riew=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return a.default.produce.apply(a.default,["riew"].concat(n))},t.react={riew:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return a.default.produce.apply(a.default,["reactRiew"].concat(n))}},t.chan=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return a.default.produce.apply(a.default,["channel"].concat(n))},t.state=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return a.default.produce.apply(a.default,["state"].concat(n))};var d=t.go=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return a.default.produce.apply(a.default,["routine"].concat(n))},p=t.use=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return a.default.produce.apply(a.default,[e].concat(t))},v=(t.register=function(e,n){return"object"!==(void 0===n?"undefined":u(n))&&"function"!=typeof n||(n.__registered=e),a.default.defineProduct(e,function(){return n}),n},t.logger=new f.default),h=t.grid=new c.default(v);t.reset=function(){return h.reset(),a.default.reset(),i.CHANNELS.reset(),v.reset()},t.harvester=a.default;d["@go"]=!0,d.with=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.reduce(function(e,n){return e=o({},e,"string"==typeof n?s({},n,p(n)):n)},{});return function(e){for(var n=arguments.length,t=Array(n>2?n-2:0),o=2;o<n;o++)t[o-2]=arguments[o];var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return t.push(r),d.apply(void 0,[e,u].concat(t))}}},{"./csp":8,"./grid":12,"./harvester":13,"./logger":15}],15:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e={},n=[];return e.snapshot=function(){n.length>=c&&n.shift();var e,t,r=[],u=[],l=[];o.grid.nodes().forEach(function(e){var n;(0,o.isRiew)(e)?r.push({id:(n=e).id,name:n.name,type:f,viewData:n.renderer.data(),children:n.children.map(function(e){return(0,o.isState)(e)?d(e):(0,o.isChannel)(e)?p(e):void console.warn("Riew logger: unrecognized riew child",e)})}):(0,o.isState)(e)?u.push(d(e)):(0,o.isChannel)(e)&&l.push(p(e))}),e=u.filter(function(e){return!r.find(function(n){return n.children.find(function(n){var t=n.id;return e.id===t})})}),t=l.filter(function(e){return!r.find(function(n){return n.children.find(function(n){var t=n.id;return e.id===t})})&&!u.find(function(n){return n.children.find(function(n){var t=n.id;return e.id===t})})});var s=(0,i.default)({items:[].concat(r,a(e),a(t))});return n.push(s),s},e.frames=function(){return n},e.reset=function(){n=[]},e};var r,o=e("./index"),u=e("./sanitize"),i=(r=u)&&r.__esModule?r:{default:r};function a(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}var c=100,f="RIEW",l="STATE",s="CHANNEL";function d(e){return{id:e.id,type:l,value:e.get(),children:e.children().map(function(e){if((0,o.isChannel)(e))return p(e);console.warn("Riew logger: unrecognized state child",e)})}}function p(e){var n={id:e.id,type:s,value:e.value(),puts:e.buff.puts.map(function(e){return e.item}),takes:e.buff.takes.map(function(){return"TAKE"})};return(0,o.isStateWriteChannel)(e)&&(n.stateWrite=!0),(0,o.isStateReadChannel)(e)&&(n.stateRead=!0),n}},{"./index":14,"./sanitize":18}],16:[function(e,n,t){(function(n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.default=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),o=1;o<n;o++)t[o-1]=arguments[o];return function n(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=function(n){var a=(0,u.useState)(null),l=r(a,2),s=l[0],d=l[1],p=(0,u.useState)(null),v=r(p,2),h=v[0],y=v[1],b=(0,u.useRef)(!0);return(0,u.useEffect)(function(){s&&s.update(n)},[n]),(0,u.useEffect)(function(){var e;(s=c.riew.apply(void 0,[function(e){b&&y(null===e?null:e)}].concat(t)),o&&o.length>0)&&(s=(e=s).with.apply(e,f(o)));return d(s),s.mount(n),b.current=!0,function(){b.current=!1,s.unmount()}},[]),null===h?null:i.default.createElement(e,h)};return l.displayName="Riew_"+(0,a.getFuncName)(e),l.with=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n(t)},l}()};var o,u="undefined"!=typeof window?window.React:void 0!==n?n.React:null,i=(o=u)&&o.__esModule?o:{default:o},a=e("../utils"),c=e("../index");function f(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../index":14,"../utils":21}],17:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};t.default=function e(n){for(var t=arguments.length,c=Array(t>1?t-1:0),f=1;f<t;f++)c[f-1]=arguments[f];var l=(0,u.getFuncName)(n);var s=a(n);var d={id:(0,u.getId)(l),name:l,"@riew":!0,children:[],renderer:s};var p=[];var v=[];var h={};var y={};var b=function(){var e=o.state.apply(void 0,arguments);return d.children.push(e),e};var g=function(e,n){e in y||(y[e]=!0,(0,o.sread)(e,n,{listen:!0}))};var m=d.id+"_view";var E=d.id+"_props";d.children.push((0,o.chan)(m,o.buffer.divorced()));d.children.push((0,o.chan)(E,o.buffer.divorced()));var O=function(e){return Object.keys(e).reduce(function(n,t){return o.CHANNELS.exists(e[t])||(0,o.isChannel)(e[t])?(g(e[t],function(e){(0,o.sput)(m,i({},t,e))}),(0,o.stake)(e[t],function(e){return(0,o.sput)(m,i({},t,e))})):(0,o.isState)(e[t])?(g(e[t].READ,function(e){return(0,o.sput)(m,i({},t,e))}),(0,o.stake)(e[t].READ,function(e){return(0,o.sput)(m,i({},t,e))})):n[t]=e[t],n},{})};d.mount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,u.requireObject)(e),(0,o.sput)(E,e),g(E,function(e){return(0,o.sput)(m,e)}),g(m,s.push),v=c.map(function(e){return(0,o.go)(e,function(e){"function"==typeof e&&p.push(e)},r({render:function(e){(0,u.requireObject)(e),(0,o.sput)(m,O(e))},state:b,props:E},h))}),(0,u.isObjectEmpty)(h)||(0,o.sput)(m,O(h))};d.unmount=function(){p.forEach(function(e){return e()}),p=[],d.children.forEach(function(e){(0,o.isState)(e)&&e.destroy()}),d.children=[],v.forEach(function(e){return e.stop()}),v=[],s.destroy(),(0,o.close)(E),(0,o.close)(m),o.grid.remove(d)};d.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,u.requireObject)(e),(0,o.sput)(E,e)};d.with=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return d.__setExternals(n),d};d.test=function(t){var r=e.apply(void 0,[n].concat(c));return r.__setExternals([t]),r};d.__setExternals=function(e){var n=e.reduce(function(e,n){return e=r({},e,"string"==typeof n?i({},n,(0,o.use)(n)):n)},{});h=r({},h,n)};return d};var o=e("./index"),u=e("./utils");function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var a=function(e){var n={},t=!1,r=!0;return{push:function(i){i!==o.chan.CLOSED&&i!==o.chan.ENDED&&(n=(0,u.accumulate)(n,i),t||(t=!0,Promise.resolve().then(function(){r&&e(n),t=!1})))},destroy:function(){r=!1},data:function(){return n}}}},{"./index":14,"./utils":21}],18:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=void 0;try{t=JSON.parse(r.default.stringify(e,function(e,n){return"function"==typeof n?""===n.name?"<anonymous>":"function "+n.name+"()":n instanceof Error?(0,o.default)(n):n},void 0,!0))}catch(e){n&&console.log(e),t=null}return t};var r=u(e("./vendors/CircularJSON")),o=u(e("./vendors/SerializeError"));function u(e){return e&&e.__esModule?e:{default:e}}},{"./vendors/CircularJSON":19,"./vendors/SerializeError":20}],19:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},u="~",i="\\x"+("0"+u.charCodeAt(0).toString(16)).slice(-2),a="\\"+i,c=new RegExp(i,"g"),f=new RegExp(a,"g"),l=new RegExp("(?:^|([^\\\\]))"+a),s=[].indexOf||function(e){for(var n=this.length;n--&&this[n]!==e;);return n},d=String;function p(e,n,t){return n instanceof Array?function(e,n,t){for(var r=0,o=n.length;r<o;r++)n[r]=p(e,n[r],t);return n}(e,n,t):n instanceof d?n.length?t.hasOwnProperty(n)?t[n]:t[n]=function(e,n){for(var t=0,r=n.length;t<r;e=e[n[t++].replace(f,u)]);return e}(e,n.split(u)):e:n instanceof Object?function(e,n,t){for(var r in n)n.hasOwnProperty(r)&&(n[r]=p(e,n[r],t));return n}(e,n,t):n}t.default={stringify:function(e,n,t,r){return JSON.stringify(e,function(e,n,t){var r,f,l=!!n,d=[],p=[e],v=[e],h=[t?u:"<circular>"],y=e,b=1;return l&&(f="object"===(void 0===n?"undefined":o(n))?function(e,t){return""!==e&&n.indexOf(e)<0?void 0:t}:n),function(e,n){return l&&(n=f.call(this,e,n)),""!==e&&(y!==this&&(r=b-s.call(p,this)-1,b-=r,p.splice(b,p.length),d.splice(b-1,d.length),y=this),"object"===(void 0===n?"undefined":o(n))&&n?(s.call(p,n)<0&&p.push(y=n),b=p.length,(r=s.call(v,n))<0?(r=v.push(n)-1,t?(d.push((""+e).replace(c,i)),h[r]=u+d.join(u)):h[r]=h[0]):n=h[r]):"string"==typeof n&&t&&(n=n.replace(i,a).replace(u,i))),n}}(e,n,!r),t)},parse:function(e,n){return JSON.parse(e,function(e){return function(n,t){var r="string"==typeof t;return r&&t.charAt(0)===u?new d(t.slice(1)):(""===n&&(t=p(t,t,{})),r&&(t=t.replace(l,"$1"+u).replace(a,i)),e?e.call(this,n,t):t)}}(n))}}},{}],20:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};n.exports=function(e){return"object"===(void 0===e?"undefined":o(e))?function e(n,t){var r=Array.isArray(n)?[]:{};t.push(n);var u=!0;var i=!1;var a=void 0;try{for(var c,f=Object.keys(n)[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var l=c.value,s=n[l];"function"!=typeof s&&(s&&"object"===(void 0===s?"undefined":o(s))?-1!==t.indexOf(n[l])?r[l]="[Circular]":r[l]=e(n[l],t.slice(0)):r[l]=s)}}catch(e){i=!0,a=e}finally{try{!u&&f.return&&f.return()}finally{if(i)throw a}}"string"==typeof n.name&&(r.name=n.name);"string"==typeof n.message&&(r.message=n.message);"string"==typeof n.stack&&(r.stack=n.stack);return r}(e,[]):"function"==typeof e?"[Function: "+(e.name||"anonymous")+"]":e}},{}],21:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};t.isObjectEmpty=function(e){for(var n in e)if(e.hasOwnProperty(n))return!1;return!0},t.requireObject=function(e){if(null==e||void 0!==e&&"object"!==(void 0===e?"undefined":u(e)))throw new Error('A key-value object expected. Instead "'+e+'" passed.')};t.getFuncName=function(e){if(e.name)return e.name;var n=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return n?n[1]:"unknown"};var i=0;t.getId=function(e){return e+"_"+ ++i};t.accumulate=function(e,n){return o({},e,n)},t.isPromise=function(e){return e&&"function"==typeof e.then},t.isObjectLiteral=function(e){return!!e&&e.constructor==={}.constructor};var a=t.isGenerator=function(e){return e&&"function"==typeof e.next&&"function"==typeof e.throw};t.isGeneratorFunction=function(e){var n=e.constructor;return!!n&&("GeneratorFunction"===n.name||"GeneratorFunction"===n.displayName||a(n.prototype))}},{}]},{},[14])(14)});