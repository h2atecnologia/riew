!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Riew=e()}}(function(){return function e(t,n,r){function u(i,f){if(!n[i]){if(!t[i]){var a="function"==typeof require&&require;if(!f&&a)return a(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){return u(t[i][1][e]||e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)u(r[i]);return u}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,o.default)();return n.setValue=function(e){return n.value=e},n.put=function(r,u){var o=!0;n.value.length<e?n.value.push(r):t?(n.value.shift(),n.value.push(r)):o=!1,n.takes.length>0&&n.takes.shift()(n.value.shift()),u(o)},n.take=function(e){0===n.value.length?n.takes.push(e):e(n.value.shift())},n};var r,u=e("./Interface"),o=(r=u)&&r.__esModule?r:{default:r}},{"./Interface":3}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(0,o.default)();return t.setValue=function(e){return t.value=e},t.put=function(n,r){0===t.takes.length?t.value.length<e?(t.value.push(n),r(!0)):t.puts.push(function(e){t.value.push(n),t.takes.length>0&&t.takes.shift()(t.value.shift()),r(e||!0)}):(t.value.push(n),t.takes.shift()(t.value.shift()),r(!0))},t.take=function(n){if(0===t.value.length)t.takes.push(n),t.puts.length>0&&(t.puts.shift()(),t.take(n));else{var r=t.value.shift();t.value.length<e&&t.puts.length>0&&t.puts.shift()(),n(r)}},t};var r,u=e("./Interface"),o=(r=u)&&r.__esModule?r:{default:r}},{"./Interface":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return{value:[],puts:[],takes:[],isEmpty:function(){return 0===this.value.length},reset:function(){this.value=[],this.puts=[],this.takes=[]},setValue:function(e){this.value=e},getValue:function(){return this.value}}}},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=o(e("./FixedBuffer")),u=o(e("./DroppingBuffer"));function o(e){return e&&e.__esModule?e:{default:e}}var i={fixed:r.default,dropping:u.default,sliding:function(e){return(0,u.default)(e,!0)}};n.default=i},{"./DroppingBuffer":1,"./FixedBuffer":2}],5:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,f=e[Symbol.iterator]();!(r=(i=f.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){u=!0,o=e}finally{try{!r&&f.return&&f.return()}finally{if(u)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};n.chan=d,n.go=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=e.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)),u="RUNNING",o={stop:function(){u="STOPPED"}};if(!(0,f.isGenerator)(r))return(0,f.isPromise)(r)?(r.then(function(e){n&&"RUNNING"===u&&n(e)}),o):(n&&"RUNNING"===u&&n(r),o);var i=!1;return function e(t){if(!i&&"STOPPED"!==u){var o=r.next(t);if(!0===o.done)return i=!0,void(n&&n(o.value));switch(o.value.op){case a.PUT:o.value.ch.put(o.value.item,e);break;case a.TAKE:o.value.ch.take(e);break;case a.SLEEP:setTimeout(e,o.value.ms);break;default:throw new Error("Unrecognized operation "+o.value.op+" for a routine.")}}}(),o},n.put=function(e,t){return{ch:e,op:a.PUT,item:t}},n.take=function(e){return{ch:e,op:a.TAKE}},n.sleep=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{op:a.SLEEP,ms:e}},n.ops=v,n.merge=function(){for(var e=d(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.map(function(t){!function n(){t.take(function(t){t!==a.CLOSED&&t!==a.ENDED&&e.state()===a.OPEN&&(e.put(t),n())})}()}),e},n.timeout=function(e){var t=d();return setTimeout(function(){return t.close()},e),t},n.isChannel=p;var i,f=e("../utils"),a=e("./constants"),c=e("../index"),l=e("./buffer"),s=(i=l)&&i.__esModule?i:{default:i};function d(){for(var e=a.OPEN,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=function(e){var t=void 0,n=void 0;2===e.length?(t=e[0],n=e[1]):1===e.length&&"string"==typeof e[0]?(t=e[0],n=s.default.fixed()):1===e.length&&"object"===u(e[0])?(t=(0,f.getId)("ch"),n=e[0]):(t=(0,f.getId)("ch"),n=s.default.fixed());return[t,n]}(n),l=o(i,2),d=l[0],p=l[1],y={id:d,"@channel":!0};return v(y),y.buff=p,y.state=function(t){return void 0!==t&&(e=t)===a.ENDED&&c.grid.remove(y),e},y.__value=function(){return console.warn("Riew: you should not get the channel's value directly! This method is here purely for testing purposes."),p.getValue()},c.grid.add(y),y}function v(e){var t=!1,n=[];function r(){if(!t){t=!0;e.take(function t(r){r!==a.CLOSED&&r!==a.ENDED&&(n.forEach(function(e){p(e.observer)?e.observer.put(r):e.observer(r)}),e.take(t))})}}e.put=function(t,n){var r=void 0,u=n;void 0===n&&(r=new Promise(function(e){return u=e}));var o=e.state();return o===d.CLOSED||o===d.ENDED?u(o):e.buff.put(t,function(e){return u(e)}),r},e.take=function(t){var n=void 0,r=t;void 0===t&&(n=new Promise(function(e){return r=e}));var u=e.state();return u===d.ENDED?r(d.ENDED):u===d.CLOSED&&e.buff.isEmpty()?(e.state(d.ENDED),r(d.ENDED)):e.buff.take(function(e){return r(e)}),n},e.close=function(){var t=e.buff.isEmpty()?a.ENDED:a.CLOSED;e.state(t),e.buff.puts.forEach(function(e){return e(t)}),e.buff.takes.forEach(function(e){return e(t)}),c.grid.remove(e)},e.reset=function(){e.state(a.OPEN),e.buff.reset()},e.subscribe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,f.getId)("who"),u=(0,f.getId)("sub");return p(e)&&(t=e.id),n.find(function(e){return e.who===t})||n.push({id:u,observer:e,who:t}),r(),function(){var e=n.findIndex(function(e){return e.id===u});e>=0&&n.splice(e,1)}},e.map=function(t){var n=d();return e.subscribe(function(e){return n.put(t(e))}),n},e.filter=function(t){var n=d();return e.subscribe(function(e){t(e)&&n.put(e)}),n},e.isActive=function(){return e.state()===a.OPEN}}function p(e){return e&&!0===e["@channel"]}d.OPEN=a.OPEN,d.CLOSED=a.CLOSED,d.ENDED=a.ENDED},{"../index":11,"../utils":14,"./buffer":4,"./constants":6}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.OPEN=Symbol("OPEN"),n.CLOSED=Symbol("CLOSED"),n.ENDED=Symbol("ENDED"),n.PUT="PUT",n.TAKE="TAKE",n.SLEEP="SLEEP"},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./buffer");Object.defineProperty(n,"buffer",{enumerable:!0,get:function(){return(e=r,e&&e.__esModule?e:{default:e}).default;var e}});var u=e("./channel");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}})});var o=e("./state");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})})},{"./buffer":4,"./channel":5,"./state":8}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.state=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=t[0],i=[],f=[],a=function(){var e=(0,r.chan)();return f.push(e),e},c=function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({"@state":!0,getState:function(){return o},set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return t},t=a();return t.subscribe(function(t){var n=e(o,t);(0,u.isPromise)(n)?n.then(function(e){o=e,i.forEach(function(e){return e(o)})}):(o=n,i.forEach(function(e){return e(o)}))}),t},map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},n=a();return i.push(function(t){n.put(e(t))}),t.length>0&&n.put(e(o)),n},filter:function(e){var n=a();return i.push(function(t){e(t)&&n.put(t)}),e(o)&&t.length>0&&n.put(o),n},destroy:function(){i=[],f.forEach(function(e){return e.close()}),f=[]}},Symbol.iterator,function(){var e=[c.map(),c.set()],t=0;return{next:function(){return{value:e[t++],done:t>c.length}}}});return c},n.isState=function(e){return e&&!0===e["@state"]};var r=e("./channel"),u=e("../utils")},{"../utils":14,"./channel":5}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,u,o=(u=[],(r={}).add=function(e){if(!e||!e.id)throw new Error('Each node in the grid must be an object with "id" field. Instead "'+e+'" given.');u.push(e)},r.remove=function(e){var t=u.findIndex(function(t){return t.id===e.id});t>=0&&u.splice(t,1)},r.reset=function(){u=[]},r.nodes=function(){return u},r.getNodeById=function(e){return u.find(function(t){return t.id===e})},r);n.default=o},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=i(e("./riew")),u=i(e("./react")),o=i(e("./grid"));function i(e){return e&&e.__esModule?e:{default:e}}var f,a,c=function(e){e.defineProduct("riew",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),u=1;u<t;u++)n[u-1]=arguments[u];var i=r.default.apply(void 0,[e].concat(n));return o.default.add(i),i}),e.defineProduct("reactRiew",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return u.default.apply(void 0,[e].concat(n))})},l=(a={},(f={}).defineProduct=function(e,t){if(a[e])throw new Error('A product with type "'+e+'" already exists.');a[e]=t},f.undefineProduct=function(e){if(!a[e])throw new Error('There is no product with type "'+e+'" to be removed.');delete a[e]},f.produce=function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),u=1;u<n;u++)r[u-1]=arguments[u];if(!a[e])throw new Error('There is no product with type "'+e+'".');return(t=a)[e].apply(t,r)},f.reset=function(){a={},c(f)},f.debug=function(){return{productNames:Object.keys(a)}},f);c(l),n.default=l},{"./grid":9,"./react":12,"./riew":13}],11:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0}),n.grid=n.harvester=n.reset=n.register=n.use=n.react=n.riew=void 0;var u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},o=e("./csp");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(n,e,{enumerable:!0,get:function(){return o[e]}})});var i=a(e("./harvester")),f=a(e("./grid"));function a(e){return e&&e.__esModule?e:{default:e}}n.riew=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.default.produce.apply(i.default,["riew"].concat(t))},n.react={riew:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.default.produce.apply(i.default,["reactRiew"].concat(t))}},n.use=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return i.default.produce.apply(i.default,[e].concat(n))},n.register=function(e,t){return"object"!==(void 0===t?"undefined":u(t))&&"function"!=typeof t||(t.__registered=e),i.default.defineProduct(e,function(){return t}),t},n.reset=function(){return f.default.reset(),i.default.reset()},n.harvester=i.default,n.grid=f.default},{"./csp":7,"./grid":9,"./harvester":10}],12:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,f=e[Symbol.iterator]();!(r=(i=f.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){u=!0,o=e}finally{try{!r&&f.return&&f.return()}finally{if(u)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};n.default=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),u=1;u<t;u++)n[u-1]=arguments[u];return function t(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=function(t){var f=(0,o.useState)(null),l=r(f,2),s=l[0],d=l[1],v=(0,o.useState)(null),p=r(v,2),y=p[0],h=p[1],b=(0,o.useRef)(!0);return(0,o.useEffect)(function(){s&&s.update(t)},[t]),(0,o.useEffect)(function(){var e;(s=a.riew.apply(void 0,[function(e){b&&h(null===e?null:e)}].concat(n)),u&&u.length>0)&&(s=(e=s).with.apply(e,c(u)));return d(s),s.mount(t),b.current=!0,function(){b.current=!1,s.unmount()}},[]),null===y?null:i.default.createElement(e,y)};return l.displayName="Riew_"+(0,f.getFuncName)(e),l.with=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t(n)},l}()};var u,o="undefined"!=typeof window?window.React:void 0!==t?t.React:null,i=(u=o)&&u.__esModule?u:{default:u},f=e("../utils"),a=e("../index");function c(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../index":11,"../utils":14}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};n.default=function e(t){for(var n=arguments.length,c=Array(n>1?n-1:0),l=1;l<n;l++)c[l-1]=arguments[l];var s={id:(0,o.getId)("r"),name:(0,o.getFuncName)(t)};var d=a(t);var v=[];var p=[];var y=[];var h=[];var b={};var m=function(){var e=i.chan.apply(void 0,arguments);return v.push(e),e};var g=function(){var e=i.state.apply(void 0,arguments);return p.push(e),e};var E=m(s.name+"_view");var w=m(s.name+"_props");var _=function(e){return Object.keys(e).reduce(function(t,n){if((0,i.isChannel)(e[n])){var r=e[n];r.subscribe(function(e){E.put(f({},n,e))},r.id+s.id)}else if((0,i.isState)(e[n])){var u=e[n].map();u.subscribe(function(e){E.put(f({},n,e))},u.id+s.id)}else t[n]=e[n];return t},{})};s.mount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o.requireObject)(e),w.subscribe(E),E.subscribe(d.push),h=c.map(function(e){return(0,i.go)(e,[r({render:function(e){(0,o.requireObject)(e),E.put(_(e))},chan:m,state:g,props:w},b)],function(e){"function"==typeof e&&y.push(e)})}),(0,o.isObjectEmpty)(b)||E.put(_(b)),w.put(e)};s.unmount=function(){y.forEach(function(e){return e()}),y=[],v.forEach(function(e){return e.close()}),v=[],p.forEach(function(e){return e.destroy()}),p=[],h.forEach(function(e){return e.stop()}),h=[],d.destroy()};s.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o.requireObject)(e),w.put(e)};s.with=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.__setExternals(t),s};s.test=function(n){var r=e.apply(void 0,[t].concat(c));return r.__setExternals([n]),r};s.__setExternals=function(e){e=e.reduce(function(e,t){return e=r({},e,"string"==typeof t?f({},t,(0,u.use)(t)):t)},{}),b=r({},b,e)};return s};var u=e("./index"),o=e("./utils"),i=e("./csp");function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(e){var t={},n=!1,r=!0;return{push:function(u){u!==i.chan.CLOSED&&u!==i.chan.ENDED&&(t=(0,o.accumulate)(t,u),n||(n=!0,Promise.resolve().then(function(){r&&e(t),n=!1})))},destroy:function(){r=!1}}}},{"./csp":7,"./index":11,"./utils":14}],14:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};n.isObjectEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},n.requireObject=function(e){if(null==e||void 0!==e&&"object"!==(void 0===e?"undefined":o(e)))throw new Error('A key-value object expected. Instead "'+e+'" passed.')},n.accumulate=function(e,t){return u({},e,t)};n.isPromise=function(e){return e&&"function"==typeof e.then},n.isGenerator=function(e){return e&&"function"==typeof e.next},n.isObjectLiteral=function(e){return!!e&&e.constructor==={}.constructor},n.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"};var i=0;n.getId=function(e){return e+"_"+ ++i}},{}]},{},[11])(11)});