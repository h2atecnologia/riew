!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Riew=e()}}(function(){return function e(n,t,r){function o(i,a){if(!t[i]){if(!n[i]){var f="function"==typeof require&&require;if(!a&&f)return f(i,!0);if(u)return u(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){return o(n[i][1][e]||e)},l,l.exports,e,n,t,r)}return t[i].exports}for(var u="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./utils"),o=(e("../index"),{dropping:!1,sliding:!1,memory:!1}),u=function(e,n){return n(e)};function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,t=n.dropping,i=n.sliding,a=n.memory,f={value:[],puts:[],takes:[],hooks:{beforePut:u,afterPut:u,beforeTake:function(e){return e()},afterTake:u},parent:null,beforePut:function(e){return f.hooks.beforePut=e},afterPut:function(e){return f.hooks.afterPut=e},beforeTake:function(e){return f.hooks.beforeTake=e},afterTake:function(e){return f.hooks.afterTake=e},isEmpty:function(){return 0===f.value.length},reset:function(){f.value=[],f.puts=[],f.takes=[]},setValue:function(e){f.value=e},getValue:function(){return f.value},decomposeTakers:function(){return f.takes.reduce(function(e,n){return e[n.options.read?"readers":"takers"].push(n),e},{readers:[],takers:[]})},consumeTake:function(e,n){if(!e.options.listen){var t=f.takes.findIndex(function(n){return n===e});t>=0&&f.takes.splice(t,1)}e.callback(n)},deleteReader:function(e){var n=f.takes.findIndex(function(n){return n.callback===e});n>=0&&f.takes.splice(n,1)},deleteReaders:function(){f.takes=f.takes.filter(function(e){return!e.options.read})}};f.setValue=function(e){return f.value=e};return f.put=function(n,r){return f.hooks.beforePut(n,function(n){return function(n,r){var o=f.decomposeTakers(),u=o.readers,c=o.takers;if(u.forEach(function(e){return f.consumeTake(e,n)}),a)return f.value=[n],r(!0),void(c.length>0&&f.consumeTake(c[0],n));if(c.length>0)f.consumeTake(c[0],n),r(!0);else{if(f.value.length<e)return f.value.push(n),void r(!0);if(t)return void r(!1);if(i)return f.value.shift(),f.value.push(n),void r(!0);f.puts.push({callback:function(e){f.value.push(n),r(e||!0)},item:n})}}(n,function(e){return f.hooks.afterPut(e,function(e){r(e)})})})},f.take=function(n,t){return f.hooks.beforeTake(function(){return function(n,t){if(t=(0,r.normalizeOptions)(t),0===f.value.length){if(!(f.puts.length>0)||t.read)return f.takes.push({callback:n,options:t}),function(){return f.deleteReader(n)};f.puts.shift().callback(),n(f.value.shift())}else if(a){if(n(f.value[0]),t.listen)return f.takes.push({callback:n,options:t}),function(){return f.deleteReader(n)}}else if(t.read)n(f.value[0]);else{var o=f.value.shift();n(o),f.value.length<e&&f.puts.length>0&&f.puts.shift().callback()}return function(){}}(function(e){return f.hooks.afterTake(e,function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,t)})},t)})},f}var a={fixed:i,dropping:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e<1)throw new Error("The dropping buffer should have at least size of one.");return i(e,{dropping:!0})},sliding:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e<1)throw new Error("The sliding buffer should have at least size of one.");return i(e,{sliding:!0})},memory:function(){return i(0,{memory:!0})}};t.default=a},{"../index":9,"./utils":7}],2:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};t.chan=function(){for(var e=f.OPEN,n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];var i=function(e){var n=void 0,t=void 0;2===e.length?(n=e[0],t=e[1]):1===e.length&&"string"==typeof e[0]?(n=e[0],t=s.default.fixed()):1===e.length&&"object"===u(e[0])?(n=(0,a.getId)("ch"),t=e[0]):(n=(0,a.getId)("ch"),t=s.default.fixed());return[n,t]}(t),l=o(i,2),d=l[0],p=l[1];if(c.CHANNELS.exists(d))return c.CHANNELS.get(d);var y=c.CHANNELS.set(d,{id:d,"@channel":!0,subscribers:[]});p.parent=y.id,y.isActive=function(){return y.state()===f.OPEN},y.buff=p,y.state=function(n){return void 0!==n&&(e=n),e},y.value=function(){return p.getValue()},y.beforePut=p.beforePut,y.afterPut=p.afterPut,y.beforeTake=p.beforeTake,y.afterTake=p.afterTake,c.grid.add(y),!1;return y};var i,a=e("../utils"),f=e("./constants"),c=e("../index"),l=e("./buf"),s=(i=l)&&i.__esModule?i:{default:i}},{"../index":9,"../utils":17,"./buf":1,"./constants":3}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OPEN=Symbol("OPEN"),t.CLOSED=Symbol("CLOSED"),t.ENDED=Symbol("ENDED"),t.PUT="PUT",t.TAKE="TAKE",t.NOOP="NOOP",t.SLEEP="SLEEP",t.STOP="STOP",t.READ="READ",t.CALL_ROUTINE="CALL_ROUTINE",t.FORK_ROUTINE="FORK_ROUTINE",t.NOTHING=Symbol("NOTHING"),t.ALL_REQUIRED=Symbol("ALL_REQUIRED"),t.ONE_OF=Symbol("ONE_OF"),t.CHANNELS={channels:{},getAll:function(){return this.channels},get:function(e){return this.channels[e]},set:function(e,n){return this.channels[e]=n,n},del:function(e){delete this.channels[e]},exists:function(e){return!!this.channels[e]},reset:function(){this.channels={}}}},{}],4:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("./buf");Object.defineProperty(t,"buffer",{enumerable:!0,get:function(){return(e=r,e&&e.__esModule?e:{default:e}).default;var e}});var o=e("./channel");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=e("./ops");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var i=e("./state");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=e("./constants");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},{"./buf":1,"./channel":2,"./constants":3,"./ops":5,"./state":6}],5:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStateWriteChannel=t.isStateReadChannel=t.isRoutine=t.isState=t.isRiew=t.isChannel=void 0;var r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};t.sput=s,t.put=function(e,n){return{channels:e,op:o.PUT,item:n}},t.stake=d,t.take=function(e,n){return{channels:e,op:o.TAKE,options:n}},t.read=function(e,n){return{channels:e,op:o.READ,options:r({},n,{read:!0})}},t.sread=p,t.unreadAll=function(e){e.buff.deleteReaders()},t.close=y,t.sclose=function(e){return y(e)},t.channelReset=h,t.schannelReset=function(e){h(e)},t.call=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return{op:o.CALL_ROUTINE,routine:e,args:t}},t.fork=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return{op:o.FORK_ROUTINE,routine:e,args:t}},t.merge=function(){for(var e=(0,u.chan)(),n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return t.forEach(function(n){!function t(){d(n,function(n){n!==o.CLOSED&&n!==o.ENDED&&e.state()===o.OPEN&&s(e,n,t)})}()}),e},t.timeout=function(e){var n=(0,u.chan)();return setTimeout(function(){return y(n)},e),n},t.go=v,t.sleep=function(e,n){if("function"!=typeof n)return{op:o.SLEEP,ms:e};setTimeout(n,e)},t.stop=function(){return{op:o.STOP}};var o=e("./constants"),u=e("../index"),i=e("../utils"),a=e("./utils");function f(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}var l=function(){};function s(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l,r=(e=(0,a.normalizeChannels)(e,"WRITE")).map(function(){return o.NOTHING}),u=function(e,n){r[e]=n,r.includes(o.NOTHING)||t(1===r.length?r[0]:r)};e.forEach(function(e,t){var r=e.state();r!==o.OPEN?u(t,r):e.buff.put(n,function(e){return u(t,e)})})}function d(e,n,t){e=(0,a.normalizeChannels)(e),t=(0,a.normalizeOptions)(t),n=(0,a.normalizeTo)(n);var r=void 0;if(t.strategy===o.ALL_REQUIRED){var u=e.map(function(){return o.NOTHING}),i=function(e,t){u[e]=t,u.includes(o.NOTHING)||n(1===u.length?u[0]:[].concat(c(u)))};r=e.map(function(e,n){var r=e.state();if(r===o.ENDED)i(n,r);else{if(r!==o.CLOSED||!e.buff.isEmpty())return e.buff.take(function(e){return i(n,e)},t);e.state(o.ENDED),i(n,o.ENDED)}})}else{if(t.strategy!==o.ONE_OF)throw new Error('Unrecognized strategy "'+t.strategy+'"');var f=function(){t.listen||r.filter(function(e){return e}).forEach(function(e){return e()}),n.apply(void 0,arguments)};r=e.map(function(e,n){var r=e.state();if(r===o.ENDED)f(r,n);else{if(r!==o.CLOSED||!e.buff.isEmpty())return e.buff.take(function(e){return f(e,n)},t);e.state(o.ENDED),f(o.ENDED,n)}})}return function(){r.filter(function(e){return e}).forEach(function(e){return e()})}}function p(e,n,t){return d(e,n,r({},t,{read:!0}))}function y(e){return(e=(0,a.normalizeChannels)(e)).forEach(function(e){var n=e.buff.isEmpty()?o.ENDED:o.CLOSED;e.state(n),e.buff.puts.forEach(function(e){return e.callback(n)}),e.buff.takes.forEach(function(e){return e.callback(n)}),u.grid.remove(e),e.subscribers=[],o.CHANNELS.del(e.id)}),{op:o.NOOP}}function h(e){return(e=(0,a.normalizeChannels)(e)).forEach(function(e){e.state(o.OPEN),e.buff.reset()}),{op:o.NOOP}}t.isChannel=function(e){return e&&!0===e["@channel"]},t.isRiew=function(e){return e&&!0===e["@riew"]},t.isState=function(e){return e&&!0===e["@state"]},t.isRoutine=function(e){return e&&!0===e["@routine"]},t.isStateReadChannel=function(e){return e&&!0===e["@statereadchannel"]},t.isStateWriteChannel=function(e){return e&&!0===e["@statewritechannel"]};function v(e){for(var n=arguments.length,t=Array(n>2?n-2:0),r=2;r<n;r++)t[r-2]=arguments[r];var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},f="STOPPED",l="RUNNING",y=(0,i.getFuncName)(e),h={id:(0,i.getId)("routine_"+y),"@routine":!0,name:y,children:[],stop:function(){l=f,this.children.forEach(function(e){return e.stop()}),u.grid.remove(h)},rerun:function(){m=e.apply(void 0,t),E()}},b=function(e){return h.children.push(e)},m=e.apply(void 0,t);function g(e){switch(e.value.op){case o.PUT:s(e.value.channels,e.value.item,E);break;case o.TAKE:d(e.value.channels,function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];E(1===n.length?n[0]:n)},e.value.options);break;case o.NOOP:E();break;case o.SLEEP:setTimeout(E,e.value.ms);break;case o.STOP:h.stop();break;case o.READ:p(e.value.channels,E,e.value.options);break;case o.CALL_ROUTINE:b(v.apply(void 0,[e.value.routine,E].concat(c(e.value.args))));break;case o.FORK_ROUTINE:b(v.apply(void 0,[e.value.routine,function(){}].concat(c(e.value.args)))),E();break;default:throw new Error("Unrecognized operation "+e.value.op+" for a routine.")}}function E(e){if(l!==f){var n=m.next(e);!0===n.done?(a&&a(n.value),n.value&&!0===n.value["@go"]&&h.rerun()):(0,i.isPromise)(n.value)?n.value.then(function(){E.apply(void 0,arguments)}).catch(function(e){g(m.throw(e))}):g(n)}}return E(),u.grid.add(h),h}v["@go"]=!0,v.with=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];var o=n.reduce(function(e,n){return e=r({},e,"string"==typeof n?f({},n,(0,u.use)(n)):n)},{});return function(e){for(var n=arguments.length,t=Array(n>2?n-2:0),r=2;r<n;r++)t[r-2]=arguments[r];var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return t.push(o),v.apply(void 0,[e,u].concat(t))}}},{"../index":9,"../utils":17,"./constants":3,"./utils":7}],6:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.state=function(){var e=arguments.length<=0?void 0:arguments[0],n=(0,o.getId)("state"),t=[],u=[],i=arguments.length>0;function a(e){return function(n){if(null===e)throw n;e(n)}}function f(n,t){var u=n.ch,i=n.selector,f=n.onError;try{if((0,o.isGeneratorFunction)(i))return void(0,r.go)(i,function(e){return(0,r.sput)(u,e)},e);(0,r.sput)(u,i(t))}catch(e){a(f)(e)}}var c={id:n,"@state":!0,children:function(){return t.map(function(e){return e.ch}).concat(u.map(function(e){return e.ch}))},READ:n+"_read",WRITE:n+"_write",select:function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=(0,r.isChannel)(n)?n:(0,r.chan)(n,r.buffer.memory());a["@statereadchannel"]=!0;var c={ch:a,selector:o,onError:u};return t.push(c),i&&f(c,e),this},mutate:function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,n){return n},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=(0,r.isChannel)(n)?n:(0,r.chan)(n,r.buffer.memory());l["@statewritechannel"]=!0;var s={ch:l};return u.push(s),l.beforePut(function(n,u){try{if((0,o.isGeneratorFunction)(i))return void(0,r.go)(i,function(n){e=n,t.forEach(function(n){return f(n,e)}),u(e)},e,n);e=i(e,n),t.forEach(function(n){return f(n,e)}),u(e)}catch(e){a(c)(e)}}),this},destroy:function(){return t.forEach(function(e){var n=e.ch;return(0,r.sclose)(n)}),u.forEach(function(e){var n=e.ch;return(0,r.sclose)(n)}),e=void 0,r.grid.remove(c),this},get:function(){return e},set:function(n){return e=n,t.forEach(function(n){f(n,e)}),n}};c.select(c.READ),c.mutate(c.WRITE),r.grid.add(c),!1;return c};var r=e("../index"),o=e("../utils")},{"../index":9,"../utils":17}],7:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeChannels=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"READ";Array.isArray(e)||(e=[e]);return e.map(function(e){return(0,r.isState)(e)&&(e=e[n]),(0,r.isChannel)(e)?e:(0,r.chan)(e)})},t.normalizeTo=function(e){if("function"==typeof e)return e;if((0,r.isChannel)(e))return function(n){return(0,r.sput)(e,n)};if("string"==typeof e){var n=(0,r.chan)(e,r.buffer.memory());return function(e){return(0,r.sput)(n,e)}}throw new Error("'read' accepts string, channel or a function as a second argument. "+e+" given.")},t.normalizeOptions=function(e){var n=(e=e||u).onError||u.onError,t=e.strategy||o.ALL_REQUIRED,r="listen"in e&&e.listen,i="read"in e&&e.read,a="initialCall"in e?e.initialCall:u.initialCall;return{onError:n,strategy:t,initialCall:a,listen:r,read:i,userTakeCallback:e.userTakeCallback}};var r=e("../index"),o=e("./constants");var u={onError:null,initialCall:!0}},{"../index":9,"./constants":3}],8:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e={},n=[];return e.add=function(e){if(!e||!e.id)throw new Error('Each node in the grid must be an object with "id" field. Instead "'+e+'" given.');n.push(e)},e.remove=function(e){var t=n.findIndex(function(n){return n.id===e.id});t>=0&&n.splice(t,1)},e.reset=function(){n=[]},e.nodes=function(){return n},e.getNodeById=function(e){return n.find(function(n){return n.id===e})},e}},{}],9:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.registry=t.reset=t.grid=t.logger=t.register=t.use=t.react=void 0;var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},u=e("./riew");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var i=e("./csp");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var a=d(e("./registry")),f=d(e("./grid")),c=d(e("./logger")),l=e("./utils"),s=d(e("./react"));function d(e){return e&&e.__esModule?e:{default:e}}t.react={riew:function(){return s.default.apply(void 0,arguments)}},t.use=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return a.default.produce.apply(a.default,[e].concat(t))},t.register=function(e,n){return"object"!==(void 0===n?"undefined":o(n))&&"function"!=typeof n||(n.__registered=e),a.default.defineProduct(e,function(){return n}),n};var p=t.logger=new c.default,y=t.grid=new f.default;t.reset=function(){return(0,l.resetIds)(),y.reset(),a.default.reset(),i.CHANNELS.reset(),p.reset()},t.registry=a.default},{"./csp":4,"./grid":8,"./logger":10,"./react":11,"./registry":12,"./riew":13,"./utils":17}],10:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e={},n=[],t=[],r=!1;return e.log=function(n,o,u){t.push({who:n.id,what:o,meta:(0,i.default)(u)}),r||(r=!0,Promise.resolve().then(function(){e.snapshot(t),r=!1,t=[]}))},e.snapshot=function(e){n.length>=f&&n.shift();var t,r,u,l=[],s=[],d=[],v=[];o.grid.nodes().forEach(function(e){var n;(0,o.isRiew)(e)?l.push({id:(n=e).id,name:n.name,type:c,viewData:(0,i.default)(n.renderer.data()),children:n.children.map(function(e){return(0,o.isState)(e)?p(e):(0,o.isChannel)(e)?y(e):(0,o.isRoutine)(e)?h(e):void console.warn("Riew logger: unrecognized riew child",e)})}):(0,o.isState)(e)?s.push(p(e)):(0,o.isChannel)(e)?d.push(y(e)):(0,o.isRoutine)(e)?v.push(h(e)):console.warn("Riew logger: unrecognized entity type",e)}),t=s.filter(function(e){return!l.find(function(n){return n.children.find(function(n){var t=n.id;return e.id===t})})}),u=d.filter(function(e){return!l.find(function(n){return n.children.find(function(n){var t=n.id;return e.id===t})})&&!s.find(function(n){return n.children.find(function(n){var t=n.id;return e.id===t})})}),r=v.filter(function(e){return!l.find(function(n){return n.children.find(function(n){var t=n.id;return e.id===t})})});var b=(0,i.default)({actions:e,state:[].concat(l,a(t),a(u),a(r))});return n.push(b),b},e.frames=function(){return n},e.reset=function(){n=[]},e};var r,o=e("./index"),u=e("./sanitize"),i=(r=u)&&r.__esModule?r:{default:r};function a(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}var f=100,c="RIEW",l="STATE",s="CHANNEL",d="ROUTINE";function p(e){return{id:e.id,type:l,value:(0,i.default)(e.get()),children:e.children().map(function(e){if((0,o.isChannel)(e))return y(e);console.warn("Riew logger: unrecognized state child",e)})}}function y(e){var n={id:e.id,type:s,value:(0,i.default)(e.value()),puts:e.buff.puts.map(function(e){return{item:e.item}}),takes:e.buff.takes.map(function(e){var n=e.options;return{read:n.read,listen:n.listen}})};return(0,o.isStateWriteChannel)(e)&&(n.stateWrite=!0),(0,o.isStateReadChannel)(e)&&(n.stateRead=!0),n}function h(e){return{id:e.id,type:d,name:e.name}}},{"./index":9,"./sanitize":14}],11:[function(e,n,t){(function(n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.default=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),o=1;o<n;o++)t[o-1]=arguments[o];return function n(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l=function(n){var a=(0,u.useState)(null),l=r(a,2),s=l[0],d=l[1],p=(0,u.useState)(null),y=r(p,2),h=y[0],v=y[1],b=(0,u.useRef)(!0);return(0,u.useEffect)(function(){s&&s.update(n)},[n]),(0,u.useEffect)(function(){var e;(s=f.riew.apply(void 0,[function(e){b&&v(null===e?null:e)}].concat(t)),o&&o.length>0)&&(s=(e=s).with.apply(e,c(o)));return d(s),s.mount(n),b.current=!0,function(){b.current=!1,s.unmount()}},[]),null===h?null:i.default.createElement(e,h)};return l.displayName="Riew_"+(0,a.getFuncName)(e),l.with=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n(t)},l}()};var o,u="undefined"!=typeof window?window.React:void 0!==n?n.React:null,i=(o=u)&&o.__esModule?o:{default:o},a=e("../utils"),f=e("../index");function c(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../index":9,"../utils":17}],12:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,u=(o={},(r={}).defineProduct=function(e,n){if(o[e])throw new Error('A product with type "'+e+'" already exists.');o[e]=n},r.undefineProduct=function(e){if(!o[e])throw new Error('There is no product with type "'+e+'" to be removed.');delete o[e]},r.produce=function(e){for(var n,t=arguments.length,r=Array(t>1?t-1:0),u=1;u<t;u++)r[u-1]=arguments[u];if(!o[e])throw new Error('There is no product with type "'+e+'".');return(n=o)[e].apply(n,r)},r.reset=function(){o={}},r.debug=function(){return{productNames:Object.keys(o)}},r);t.default=u},{}],13:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};t.riew=function e(n){for(var t=arguments.length,c=Array(t>1?t-1:0),l=1;l<t;l++)c[l-1]=arguments[l];var s=(0,u.getFuncName)(n);var d=f(function(e){n(e)});var p={id:(0,u.getId)("riew_"+s),name:s,"@riew":!0,children:[],renderer:d};var y=[];var h={};var v={};var b=function(){var e=o.state.apply(void 0,arguments);return p.children.push(e),e};var m=function(e,n){e in v||(v[e]=!0,(0,o.sread)(e,n,{listen:!0}))};var g=(0,u.getId)("channel_view_"+s);var E=(0,u.getId)("channel_props_"+s);p.children.push((0,o.chan)(g,o.buffer.memory()));p.children.push((0,o.chan)(E,o.buffer.memory()));var O=function(e){return Object.keys(e).reduce(function(n,t){return o.CHANNELS.exists(e[t])||(0,o.isChannel)(e[t])?(m(e[t],function(e){(0,o.sput)(g,a({},t,e))}),(0,o.stake)(e[t],function(e){return(0,o.sput)(g,a({},t,e))})):(0,o.isState)(e[t])?(m(e[t].READ,function(e){return(0,o.sput)(g,a({},t,e))}),(0,o.stake)(e[t].READ,function(e){return(0,o.sput)(g,a({},t,e))})):n[t]=e[t],n},{})};p.mount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,u.requireObject)(e),(0,o.sput)(E,e),m(E,function(e){return(0,o.sput)(g,e)}),m(g,d.push),p.children=p.children.concat(c.map(function(e){return(0,o.go)(e,function(e){"function"==typeof e&&y.push(e)},r({render:function(e){(0,u.requireObject)(e),(0,o.sput)(g,O(e))},state:b,props:E},h))})),(0,u.isObjectEmpty)(h)||(0,o.sput)(g,O(h))};p.unmount=function(){y.forEach(function(e){return e()}),y=[],p.children.forEach(function(e){(0,o.isState)(e)?e.destroy():(0,i.isRoutine)(e)&&e.stop()}),p.children=[],d.destroy(),(0,o.close)(E),(0,o.close)(g),o.grid.remove(p)};p.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,u.requireObject)(e),(0,o.sput)(E,e)};p.with=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return p.__setExternals(n),p};p.test=function(t){var r=e.apply(void 0,[n].concat(c));return r.__setExternals([t]),r};p.__setExternals=function(e){var n=e.reduce(function(e,n){return e=r({},e,"string"==typeof n?a({},n,(0,o.use)(n)):n)},{});h=r({},h,n)};o.grid.add(p);0;return p};var o=e("./index"),u=e("./utils"),i=e("./csp");function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var f=function(e){var n={},t=!1,r=!0;return{push:function(i){i!==o.chan.CLOSED&&i!==o.chan.ENDED&&(n=(0,u.accumulate)(n,i),t||(t=!0,Promise.resolve().then(function(){r&&e(n),t=!1})))},destroy:function(){r=!1},data:function(){return n}}}},{"./csp":4,"./index":9,"./utils":17}],14:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=void 0;try{t=JSON.parse(r.default.stringify(e,function(e,n){return"function"==typeof n?""===n.name?"<anonymous>":"function "+n.name+"()":n instanceof Error?(0,o.default)(n):n},void 0,!0))}catch(e){n&&console.log(e),t=null}return t};var r=u(e("./vendors/CircularJSON")),o=u(e("./vendors/SerializeError"));function u(e){return e&&e.__esModule?e:{default:e}}},{"./vendors/CircularJSON":15,"./vendors/SerializeError":16}],15:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},u="~",i="\\x"+("0"+u.charCodeAt(0).toString(16)).slice(-2),a="\\"+i,f=new RegExp(i,"g"),c=new RegExp(a,"g"),l=new RegExp("(?:^|([^\\\\]))"+a),s=[].indexOf||function(e){for(var n=this.length;n--&&this[n]!==e;);return n},d=String;function p(e,n,t){return n instanceof Array?function(e,n,t){for(var r=0,o=n.length;r<o;r++)n[r]=p(e,n[r],t);return n}(e,n,t):n instanceof d?n.length?t.hasOwnProperty(n)?t[n]:t[n]=function(e,n){for(var t=0,r=n.length;t<r;e=e[n[t++].replace(c,u)]);return e}(e,n.split(u)):e:n instanceof Object?function(e,n,t){for(var r in n)n.hasOwnProperty(r)&&(n[r]=p(e,n[r],t));return n}(e,n,t):n}t.default={stringify:function(e,n,t,r){return JSON.stringify(e,function(e,n,t){var r,c,l=!!n,d=[],p=[e],y=[e],h=[t?u:"<circular>"],v=e,b=1;return l&&(c="object"===(void 0===n?"undefined":o(n))?function(e,t){return""!==e&&n.indexOf(e)<0?void 0:t}:n),function(e,n){return l&&(n=c.call(this,e,n)),""!==e&&(v!==this&&(r=b-s.call(p,this)-1,b-=r,p.splice(b,p.length),d.splice(b-1,d.length),v=this),"object"===(void 0===n?"undefined":o(n))&&n?(s.call(p,n)<0&&p.push(v=n),b=p.length,(r=s.call(y,n))<0?(r=y.push(n)-1,t?(d.push((""+e).replace(f,i)),h[r]=u+d.join(u)):h[r]=h[0]):n=h[r]):"string"==typeof n&&t&&(n=n.replace(i,a).replace(u,i))),n}}(e,n,!r),t)},parse:function(e,n){return JSON.parse(e,function(e){return function(n,t){var r="string"==typeof t;return r&&t.charAt(0)===u?new d(t.slice(1)):(""===n&&(t=p(t,t,{})),r&&(t=t.replace(l,"$1"+u).replace(a,i)),e?e.call(this,n,t):t)}}(n))}}},{}],16:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};n.exports=function(e){return"object"===(void 0===e?"undefined":o(e))?function e(n,t){var r=Array.isArray(n)?[]:{};t.push(n);var u=!0;var i=!1;var a=void 0;try{for(var f,c=Object.keys(n)[Symbol.iterator]();!(u=(f=c.next()).done);u=!0){var l=f.value,s=n[l];"function"!=typeof s&&(s&&"object"===(void 0===s?"undefined":o(s))?-1!==t.indexOf(n[l])?r[l]="[Circular]":r[l]=e(n[l],t.slice(0)):r[l]=s)}}catch(e){i=!0,a=e}finally{try{!u&&c.return&&c.return()}finally{if(i)throw a}}"string"==typeof n.name&&(r.name=n.name);"string"==typeof n.message&&(r.message=n.message);"string"==typeof n.stack&&(r.stack=n.stack);return r}(e,[]):"function"==typeof e?"[Function: "+(e.name||"anonymous")+"]":e}},{}],17:[function(e,n,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};t.isObjectEmpty=function(e){for(var n in e)if(e.hasOwnProperty(n))return!1;return!0},t.requireObject=function(e){if(null==e||void 0!==e&&"object"!==(void 0===e?"undefined":u(e)))throw new Error('A key-value object expected. Instead "'+e+'" passed.')},t.resetIds=function(){i=0};t.getFuncName=function(e){if(e.name)return e.name;var n=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return n?n[1]:"unknown"};var i=0;t.getId=function(e){return e+"_"+ ++i};t.accumulate=function(e,n){return o({},e,n)},t.isPromise=function(e){return e&&"function"==typeof e.then},t.isObjectLiteral=function(e){return!!e&&e.constructor==={}.constructor};var a=t.isGenerator=function(e){return e&&"function"==typeof e.next&&"function"==typeof e.throw};t.isGeneratorFunction=function(e){var n=e.constructor;return!!n&&("GeneratorFunction"===n.name||"GeneratorFunction"===n.displayName||a(n.prototype))}},{}]},{},[9])(9)});