!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Riew=e()}}(function(){return function e(t,r,n){function u(i,a){if(!r[i]){if(!t[i]){var f="function"==typeof require&&require;if(!a&&f)return f(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var s=r[i]={exports:{}};t[i][0].call(s.exports,function(e){return u(t[i][1][e]||e)},s,s.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)u(n[i]);return u}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parallel=r.serial=r.compose=r.registry=r.react=r.riew=r.merge=r.state=void 0;var n=e("./utils");Object.defineProperty(r,"compose",{enumerable:!0,get:function(){return n.compose}}),Object.defineProperty(r,"serial",{enumerable:!0,get:function(){return n.serial}}),Object.defineProperty(r,"parallel",{enumerable:!0,get:function(){return n.parallel}});var u=e("./state"),o=f(e("./riew")),i=f(e("./react")),a=f(e("./registry"));function f(e){return e&&e.__esModule?e:{default:e}}r.state=u.createState,r.merge=u.mergeStates,r.riew=o.default,r.react={riew:i.default},r.registry=a.default},{"./react":2,"./registry":3,"./riew":4,"./state":5,"./utils":6}],2:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,u=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){u=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(u)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.default=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),f=1;f<t;f++)r[f-1]=arguments[f];return function t(){var f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=function(t){var i=(0,u.useState)(null),s=n(i,2),l=s[0],d=s[1],p=(0,u.useState)(null),y=n(p,2),v=y[0],h=y[1];return(0,u.useEffect)(function(){l&&l.update(t)},[t]),(0,u.useEffect)(function(){var n;(l=a.default.apply(void 0,[function(t){h(null===t?null:o.default.createElement(e,t))}].concat(r)),f&&f.length>0)&&(l=(n=l).with.apply(n,c(f)));return d(l),l.mount(t),function(){l.unmount()}},[]),v};return s.displayName="Riew("+(0,i.getFuncName)(e)+")",s.with=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return t(r)},s}()};var u="undefined"!=typeof window?window.React:void 0!==t?t.React:null,o=f(u),i=e("../utils"),a=f(e("../riew"));function f(e){return e&&e.__esModule?e:{default:e}}function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../riew":4,"../utils":6}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={__resources:{},__resolver:function(e){if(this.__resources[e])return this.__resources[e];throw new Error('"'+e+'" is missing in the registry.')},__dissolver:function(e){return delete this.__resources[e],e},add:function(e,t){this.__resources[e]=t},get:function(e){return this.__resolver(e)},free:function(e){return this.__dissolver(e)},custom:function(e){var t=e.resolver,r=e.dissolver;this.__resolver=t,this.__dissolver=r},reset:function(){this.__resources={}}};r.default=n},{}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(r,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)};r.default=function e(t){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var i={};var f=!1;var y=[];var v=[];var h=[];var m={};var _=(0,a.createState)({});var g=(0,a.createState)({});var b=(0,a.createState)({});var w=function(){return f};var S=g.mutate(function(e,t){var r=u({},e);return t&&Object.keys(t).forEach(function(e){(0,a.isRiewState)(t[e])?(r[e]=t[e].get(),v.find(function(r){return r.__state.id===t[e].id})||v.push(t[e].pipe(function(t){return E(l({},e,t))}).subscribe())):(0,a.isRiewQueueTrigger)(t[e])&&!t[e].isMutating()?(r[e]=t[e](),v.find(function(r){return r.__state.id===t[e].__state.id})||v.push(t[e].pipe(function(){return E(l({},e,t[e]()))}).subscribe())):r[e]=t[e]}),r});var E=S.filter(w).pipe(function(e){return t(e)});var j=b.mutate(p);var O=_.mutate(p);j({state:function(){var e=a.createState.apply(void 0,arguments);return y.push(e),e},render:function(e){return d(e,"The `render` method"),E(e)},isActive:w,props:_});function A(){Object.keys(m).forEach(function(e){var t=void 0;"@"===e.charAt(0)?(e=e.substr(1,e.length),t=c.default.get(e)):t=m[e],S(l({},e,t)),j(l({},e,t))})}i.isActive=w;i.mount=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(e,"The `mount` method"),O(e),S(e),A();var t=s.parallel.apply(void 0,n)(b.get()),r=function(e){return h=e||[]};return(0,s.isPromise)(t)?t.then(r):r(t),f=!0,E(),i};i.update=function(e){E(e),O(e)};i.unmount=function(){return f=!1,g.teardown(),b.teardown(),y.forEach(function(e){return e.teardown()}),y=[],h.filter(function(e){return"function"==typeof e}).forEach(function(e){return e()}),h=[],v.forEach(function(e){return e.unsubscribe()}),v=[],i};i.__setExternals=function(e){m=u({},m,e.reduce(function(e,t){return e=u({},e,"string"==typeof t?l({},"@"+t,!0):t)},{}))};i.with=function(){for(var r=arguments.length,u=Array(r),o=0;o<r;o++)u[o]=arguments[o];var i=e.apply(void 0,[t].concat(n));return i.__setExternals(u),i};i.test=function(r){var u=e.apply(void 0,[t].concat(n));return u.__setExternals([r]),u};return i};var i,a=e("./state"),f=e("./registry"),c=(i=f)&&i.__esModule?i:{default:i},s=e("./utils");function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e,t){if(null===e||void 0!==e&&"object"!==(void 0===e?"undefined":o(e)))throw new Error(t+' must be called with a key-value object. Instead "'+e+'" passed.');return e}var p=function(e,t){return u({},e,t)}},{"./registry":3,"./state":5,"./utils":6}],5:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(r,"__esModule",{value:!0}),r.queueMethods=void 0;var u="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)};r.createState=v,r.mergeStates=function(e){var t=function(){return Object.keys(e).reduce(function(t,r){return t[r]=e[r].get(),t},{})},r=v(t());return r.set=function(t){if("object"!==(void 0===t?"undefined":u(t)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(t).forEach(function(r){e[r].set(t[r],!1)}),r.__triggerListeners()},r.get=t,Object.keys(e).forEach(function(t){e[t].pipe(function(){r.__triggerListeners()}).subscribe()}),r},r.isRiewState=function(e){return e&&!0===e.__riew},r.isRiewQueueTrigger=function(e){return e&&!0===e.__riewTrigger};var o=f(e("fast-deep-equal")),i=e("./utils"),a=f(e("./registry"));function f(e){return e&&e.__esModule?e:{default:e}}function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l=0,d=function(e){return"@@"+e+ ++l},p=r.queueMethods=["pipe","map","mutate","filter","parallel","mapToKey"];function y(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n={index:0,result:t(),id:d("q"),items:[],add:function(e,t){this.items.push({type:e,func:t,name:t.map(i.getFuncName)})},process:function(){for(var t=arguments.length,u=Array(t),o=0;o<t;o++)u[o]=arguments[o];var a=n.items;function f(){return n.index++,n.index<a.length?c():(r(n),n.result)}function c(){var t=a[n.index],r=t.type,o=t.func;switch(r){case"pipe":var c=(o[0]||function(){}).apply(void 0,[n.result].concat(u));return(0,i.isPromise)(c)?c.then(f):f();case"map":return n.result=(o[0]||function(e){return e}).apply(void 0,[n.result].concat(u)),(0,i.isPromise)(n.result)?n.result.then(function(e){return n.result=e,f()}):f();case"mapToKey":return n.result=function(e){return s({},o[0],e)}.apply(void 0,[n.result].concat(u)),f();case"mutate":return n.result=(o[0]||function(e,t){return t}).apply(void 0,[n.result].concat(u)),(0,i.isPromise)(n.result)?n.result.then(function(t){return n.result=t,e(n.result),f()}):(e(n.result),f());case"filter":var l=o[0].apply(o,[n.result].concat(u));return(0,i.isPromise)(l)?l.then(function(e){return e||(n.index=a.length),f()}):(l||(n.index=a.length),f());case"parallel":n.result=o.map(function(e){return e.apply(void 0,[n.result].concat(u))});var d=n.result.filter(i.isPromise);return d.length>0?Promise.all(d).then(function(){return n.result.forEach(function(e,t){(0,i.isPromise)(e)&&e.then(function(e){return n.result[t]=e})}),f()}):f()}throw new Error('Unsupported method "'+r+'".')}return n.index=0,a.length>0?c():n.result},teardown:function(){this.items=[]}};return n}function v(e){var t=e,r={},n=[],u=[],i=!0,f=void 0;function s(e){e.__isStream=!0,u.push(e)}function l(e){n.push(e)}function v(e){n=n.filter(function(t){var r=t.id;return e.id!==r})}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=function e(){if(!1===i||0===e.__itemsToCreate.length)return r.get();var t=y(r.set,r.get,v);return l(t),e.__itemsToCreate.forEach(function(e){var r=e.type,n=e.func;return t.add(r,n)}),t.process.apply(t,arguments)};return t.id=d("t"),t.__isStream=!1,t.__riewTrigger=!0,t.__itemsToCreate=[].concat(c(e)),t.__state=r,p.forEach(function(e){t[e]=function(){for(var r=arguments.length,n=Array(r),u=0;u<r;u++)n[u]=arguments[u];return h([].concat(c(t.__itemsToCreate),[{type:e,func:n}]))}}),["set","get","teardown"].forEach(function(e){t[e]=function(){throw new Error('"'+e+'" is not a queue method but a method of the state object.')}}),t.isMutating=function(){return!!t.__itemsToCreate.find(function(e){return"mutate"===e.type})},t.subscribe=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t.isMutating())throw new Error("You should not subscribe a trigger that mutates the state. This will lead to endless recursion.");return e&&t(),s(t),t},t.unsubscribe=function(){return function(e){e.__isStream=!1,u=u.filter(function(t){return t.id!==e.id})}(t),t},t.cancel=function(){return t.__itemsToCreate=[],p.forEach(function(e){return t[e]=function(){return t}}),t},t.test=function(e){var r=h([].concat(c(t.__itemsToCreate))),n={setValue:function(e){r.__itemsToCreate=[{type:"map",func:[function(){return e}]}].concat(c(r.__itemsToCreate))},swap:function(e,t,n){Array.isArray(t)||(t=[t]),r.__itemsToCreate[e].func=t,n&&(r.__itemsToCreate[e].type=n)},swapFirst:function(e,t){n.swap(0,e,t)},swapLast:function(e,t){n.swap(r.__itemsToCreate.length-1,e,t)}};return e(n),r},t}return r.id=d("s"),r.__riew=!0,r.__triggerListeners=function(){(0,o.default)("a","b"),u.forEach(function(e){return e()})},r.__listeners=function(){return u},r.__queues=function(){return n},r.active=function(){return i},r.get=function(){return t},r.set=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],u=(0,o.default)(t,e);t=e,n&&!u&&r.__triggerListeners()},r.teardown=function(){n.forEach(function(e){return e.teardown()}),n=[],u=[],i=!1,f&&a.default.free(f)},r.export=function(e){return f&&a.default.free(f),a.default.add(f=e,r),r},function(e){"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&(e[Symbol.iterator]=function(){var t=[e.get,e.set,e],r=0;return{next:function(){return{value:t[r++],done:r>t.length}}}})}(r),p.forEach(function(e){r[e]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return h([{type:e,func:r}])}}),r}},{"./registry":3,"./utils":6,"fast-deep-equal":7}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=r.isPromise=function(e){return e&&"function"==typeof e.then};r.isObjectLiteral=function(e){return!!e&&e.constructor==={}.constructor},r.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"},r.compose=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,u=function(){},o=[].concat(t);return function t(){if(0!==o.length){var i=o.shift()(e);n(i)?(r=!0,i.then(function(r){e=r,t()})):(e=i,t())}else u(e)}(),r?new Promise(function(e){return u=e}):e}},r.serial=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,u=function(){},o=[],i=[].concat(t);return function t(){if(0!==i.length){var a=i.shift()(e);n(a)?(r=!0,a.then(function(e){o.push(e),t()})):(o.push(a),t())}else u(o)}(),r?new Promise(function(e){return u=e}):o}},r.parallel=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){var r=!1,u=[],o=[].concat(t);return function t(){if(0!==o.length){var i=o.shift()(e);n(i)&&(r=!0),u.push(i),t()}}(),r?Promise.all(u.map(function(e){return n(e)?e:Promise.resolve(e)})):u}}},{}],7:[function(e,t,r){"use strict";var n=Array.isArray,u=Object.keys,o=Object.prototype.hasOwnProperty;t.exports=function e(t,r){if(t===r)return!0;var i,a,f,c=n(t),s=n(r);if(c&&s){if((a=t.length)!=r.length)return!1;for(i=0;i<a;i++)if(!e(t[i],r[i]))return!1;return!0}if(c!=s)return!1;var l=t instanceof Date,d=r instanceof Date;if(l!=d)return!1;if(l&&d)return t.getTime()==r.getTime();var p=t instanceof RegExp,y=r instanceof RegExp;if(p!=y)return!1;if(p&&y)return t.toString()==r.toString();if(t instanceof Object&&r instanceof Object){var v=u(t);if((a=v.length)!==u(r).length)return!1;for(i=0;i<a;i++)if(!o.call(r,v[i]))return!1;for(i=0;i<a;i++)if(!e(t[f=v[i]],r[f]))return!1;return!0}return!1}},{}]},{},[1])(1)});