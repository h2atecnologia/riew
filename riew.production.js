!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Riew=t()}}(function(){return function t(e,r,n){function o(i,f){if(!r[i]){if(!e[i]){var a="function"==typeof require&&require;if(!f&&a)return a(i,!0);if(u)return u(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var s=r[i]={exports:{}};e[i][0].call(s.exports,function(t){return o(e[i][1][t]||t)},s,s.exports,t,e,r,n)}return r[i].exports}for(var u="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parallel=r.serial=r.compose=r.registry=r.react=r.riew=r.merge=r.state=void 0;var n=t("./utils");Object.defineProperty(r,"compose",{enumerable:!0,get:function(){return n.compose}}),Object.defineProperty(r,"serial",{enumerable:!0,get:function(){return n.serial}}),Object.defineProperty(r,"parallel",{enumerable:!0,get:function(){return n.parallel}});var o=t("./state"),u=a(t("./riew")),i=a(t("./react")),f=a(t("./registry"));function a(t){return t&&t.__esModule?t:{default:t}}r.state=o.createState,r.merge=o.mergeStates,r.riew=u.default,r.react={riew:i.default},r.registry=f.default},{"./react":2,"./registry":3,"./riew":4,"./state":5,"./utils":6}],2:[function(t,e,r){(function(e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,o=!1,u=void 0;try{for(var i,f=t[Symbol.iterator]();!(n=(i=f.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,u=t}finally{try{!n&&f.return&&f.return()}finally{if(o)throw u}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.default=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),a=1;a<e;a++)r[a-1]=arguments[a];return function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=function(e){var i=(0,o.useState)(null),s=n(i,2),l=s[0],d=s[1],p=(0,o.useState)(null),y=n(p,2),v=y[0],m=y[1];return(0,o.useEffect)(function(){l&&l.update(e)},[e]),(0,o.useEffect)(function(){var n;(l=f.default.apply(void 0,[function(e){m(null===e?null:u.default.createElement(t,e))}].concat(r)),a&&a.length>0)&&(l=(n=l).with.apply(n,c(a)));return d(l),l.mount(e),function(){l.unmount()}},[]),v};return s.displayName="Riew("+(0,i.getFuncName)(t)+")",s.with=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e(r)},s}()};var o="undefined"!=typeof window?window.React:void 0!==e?e.React:null,u=a(o),i=t("../utils"),f=a(t("../riew"));function a(t){return t&&t.__esModule?t:{default:t}}function c(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../riew":4,"../utils":6}],3:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={__resources:{},__resolver:function(t){if(this.__resources[t])return this.__resources[t];throw new Error('"'+t+'" is missing in the registry.')},__dissolver:function(t){return delete this.__resources[t],t},add:function(t,e){this.__resources[t]=e},get:function(t){return this.__resolver(t)},free:function(t){return this.__dissolver(t)},custom:function(t){var e=t.resolver,r=t.dissolver;this.__resolver=e,this.__dissolver=r},reset:function(){this.__resources={}}};r.default=n},{}],4:[function(t,e,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(r,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},u="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return void 0===t?"undefined":n(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":n(t)};r.default=function t(e){for(var r=arguments.length,n=Array(r>1?r-1:0),u=1;u<r;u++)n[u-1]=arguments[u];var i={};var a=!1;var y=[];var v=[];var m=[];var h={};var _=(0,f.createState)({});var g=(0,f.createState)({});var b=(0,f.createState)({});var w=function(){return a};var S=function(t){return!!v.find(function(e){return e.__state.id===t.id})};var E=g.mutate(function(t,e){var r=o({},t);return e&&Object.keys(e).forEach(function(t){(0,f.isRiewState)(e[t])?(r[t]=e[t].get(),S(e[t])||v.push(e[t].pipe(function(e){return j(l({},t,e))}).subscribe())):(0,f.isRiewQueueTrigger)(e[t])&&!e[t].isMutating()?(r[t]=e[t](),S(e[t].__state)||v.push(e[t].__state.pipe(function(){return j(l({},t,e[t]()))}).subscribe())):r[t]=e[t]}),r});var j=E.filter(w).pipe(function(t){return e(t)});var O=b.mutate(p);var A=_.mutate(p);O({state:function(){var t=f.createState.apply(void 0,arguments);return y.push(t),t},render:function(t){return d(t,"The `render` method"),j(t)},isActive:w,props:_});function T(){Object.keys(h).forEach(function(t){var e=void 0;"@"===t.charAt(0)?(t=t.substr(1,t.length),e=c.default.get(t)):e=h[t],E(l({},t,e)),O(l({},t,e))})}i.isActive=w;i.mount=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(t,"The `mount` method"),A(t),E(t),T();var e=s.parallel.apply(void 0,n)(b.get()),r=function(t){return m=t||[]};return(0,s.isPromise)(e)?e.then(r):r(e),a=!0,j(),i};i.update=function(t){j(t),A(t)};i.unmount=function(){return a=!1,g.teardown(),b.teardown(),y.forEach(function(t){return t.teardown()}),y=[],m.filter(function(t){return"function"==typeof t}).forEach(function(t){return t()}),m=[],v.forEach(function(t){return t.unsubscribe()}),v=[],i};i.__setExternals=function(t){h=o({},h,t.reduce(function(t,e){return t=o({},t,"string"==typeof e?l({},"@"+e,!0):e)},{}))};i.with=function(){for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];var i=t.apply(void 0,[e].concat(n));return i.__setExternals(o),i};i.test=function(r){var o=t.apply(void 0,[e].concat(n));return o.__setExternals([r]),o};return i};var i,f=t("./state"),a=t("./registry"),c=(i=a)&&i.__esModule?i:{default:i},s=t("./utils");function l(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function d(t,e){if(null===t||void 0!==t&&"object"!==(void 0===t?"undefined":u(t)))throw new Error(e+' must be called with a key-value object. Instead "'+t+'" passed.');return t}var p=function(t,e){return o({},t,e)}},{"./registry":3,"./state":5,"./utils":6}],5:[function(t,e,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return void 0===t?"undefined":n(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":n(t)};r.createState=_,r.mergeStates=function(t){var e=function(){return Object.keys(t).reduce(function(e,r){return e[r]=t[r].get(),e},{})},r=_(e());return r.set=function(e){if("object"!==(void 0===e?"undefined":o(e)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(e).forEach(function(r){t[r].set(e[r],!1)}),r.__triggerListeners()},r.get=e,Object.keys(t).forEach(function(e){t[e].pipe(function(){r.__triggerListeners()}).subscribe()}),r},r.isRiewState=function(t){return t&&!0===t.__riew},r.isRiewQueueTrigger=function(t){return t&&!0===t.__riewTrigger};var u=a(t("fast-deep-equal")),i=t("./utils"),f=a(t("./registry"));function a(t){return t&&t.__esModule?t:{default:t}}function c(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var s=0,l=function(t){return"@@"+t+ ++s};function d(t){return function(e,r,n){var o=(t||function(){}).apply(void 0,[e].concat(c(r)));return(0,i.isPromise)(o)?o.then(function(){return n(e)}):n(e)}}function p(t){return function(e,r,n){var o=(t||function(t){return t}).apply(void 0,[e].concat(c(r)));return(0,i.isPromise)(o)?o.then(n):n(o)}}function y(t){return function(e,r,n){return n(function(e){return function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}({},t,e)}.apply(void 0,[e].concat(c(r))))}}function v(t){return function(e,r,n,o){var u=(t||function(t,e){return e}).apply(void 0,[e].concat(c(r)));return(0,i.isPromise)(u)?u.then(function(t){return o.setStateValue(t),n(t)}):(o.setStateValue(u),n(u))}}function m(t){return function(e,r,n,o){var u=t.apply(void 0,[e].concat(c(r)));return(0,i.isPromise)(u)?u.then(function(t){return t||(o.index=o.items.length),n(e)}):(u||(o.index=o.items.length),n(e))}}function h(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments[3],o={index:0,setStateValue:t,getStateValue:e,result:e(),id:l("q"),items:[],add:function(t,e){this.items.push({type:t,func:e,name:e.map(i.getFuncName)})},process:function(){for(var t=arguments.length,e=Array(t),u=0;u<t;u++)e[u]=arguments[u];var i=o.items;function f(t){return o.result=t,o.index++,o.index<i.length?a():(r(o),o.result)}function a(){var t=i[o.index],r=t.type,u=t.func,a=n[r];if(a)return a(o,u,e,f);throw new Error('Unsupported method "'+r+'".')}return o.index=0,i.length>0?a():o.result},teardown:function(){this.items=[]}};return o}function _(t){var e={},r=[],n={},o=t,a=[],s=[],_=!0,g=void 0;function b(t,o){r.push(t),n[t]=function(t,e,r,n){var u=o.apply(void 0,c(e))(t.result,r,n,t);return(0,i.isPromise)(u)?u.then(n):n(u)},e[t]=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return j([{type:t,func:r}])}}function w(t){t.__isStream=!0,s.push(t)}function S(t){a.push(t)}function E(t){a=a.filter(function(e){var r=e.id;return t.id!==r})}function j(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=function t(){if(!1===_||0===t.__itemsToCreate.length)return e.get();var r=h(e.set,e.get,E,n);return S(r),t.__itemsToCreate.forEach(function(t){var e=t.type,n=t.func;return r.add(e,n)}),r.process.apply(r,arguments)};return o.id=l("t"),o.__isStream=!1,o.__riewTrigger=!0,o.__itemsToCreate=[].concat(c(t)),o.__state=e,r.forEach(function(t){o[t]=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return j([].concat(c(o.__itemsToCreate),[{type:t,func:r}]))}}),["set","get","teardown"].forEach(function(t){o[t]=function(){throw new Error('"'+t+'" is not a queue method but a method of the state object.')}}),o.define=function(t,e){return b(t,e),o[t]=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return j([].concat(c(o.__itemsToCreate),[{type:t,func:r}]))},o},o.isMutating=function(){return!!o.__itemsToCreate.find(function(t){return"mutate"===t.type})},o.subscribe=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(o.isMutating())throw new Error("You should not subscribe a trigger that mutates the state. This will lead to endless recursion.");return t&&o(),w(o),o},o.unsubscribe=function(){return function(t){t.__isStream=!1,s=s.filter(function(e){return e.id!==t.id})}(o),o},o.cancel=function(){return o.__itemsToCreate=[],r.forEach(function(t){return o[t]=function(){return o}}),o},o.test=function(t){var e=j([].concat(c(o.__itemsToCreate))),r={setValue:function(t){e.__itemsToCreate=[{type:"map",func:[function(){return t}]}].concat(c(e.__itemsToCreate))},swap:function(t,r,n){Array.isArray(r)||(r=[r]),e.__itemsToCreate[t].func=r,n&&(e.__itemsToCreate[t].type=n)},swapFirst:function(t,e){r.swap(0,t,e)},swapLast:function(t,n){r.swap(e.__itemsToCreate.length-1,t,n)}};return t(r),e},o}return e.id=l("s"),e.__riew=!0,e.__triggerListeners=function(){(0,u.default)("a","b"),s.forEach(function(t){return t()})},e.__listeners=function(){return s},e.__queues=function(){return a},e.active=function(){return _},e.get=function(){return o},e.set=function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(0,u.default)(o,t);o=t,r&&!n&&e.__triggerListeners()},e.teardown=function(){a.forEach(function(t){return t.teardown()}),a=[],s=[],_=!1,g&&f.default.free(g)},e.export=function(t){return g&&f.default.free(g),f.default.add(g=t,e),e},e.define=function(){return b.apply(void 0,arguments),e},b("pipe",d),b("map",p),b("mapToKey",y),b("mutate",v),b("filter",m),function(t){"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&(t[Symbol.iterator]=function(){var e=[t.map(),t.mutate(),t],r=0;return{next:function(){return{value:e[r++],done:r>e.length}}}})}(e),e}},{"./registry":3,"./utils":6,"fast-deep-equal":7}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=r.isPromise=function(t){return t&&"function"==typeof t.then};r.isObjectLiteral=function(t){return!!t&&t.constructor==={}.constructor},r.getFuncName=function(t){if(t.name)return t.name;var e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:"unknown"},r.compose=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){var r=!1,o=function(){},u=[].concat(e);return function e(){if(0!==u.length){var i=u.shift()(t);n(i)?(r=!0,i.then(function(r){t=r,e()})):(t=i,e())}else o(t)}(),r?new Promise(function(t){return o=t}):t}},r.serial=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){var r=!1,o=function(){},u=[],i=[].concat(e);return function e(){if(0!==i.length){var f=i.shift()(t);n(f)?(r=!0,f.then(function(t){u.push(t),e()})):(u.push(f),e())}else o(u)}(),r?new Promise(function(t){return o=t}):u}},r.parallel=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){var r=!1,o=[],u=[].concat(e);return function e(){if(0!==u.length){var i=u.shift()(t);n(i)&&(r=!0),o.push(i),e()}}(),r?Promise.all(o.map(function(t){return n(t)?t:Promise.resolve(t)})):o}}},{}],7:[function(t,e,r){"use strict";var n=Array.isArray,o=Object.keys,u=Object.prototype.hasOwnProperty;e.exports=function t(e,r){if(e===r)return!0;var i,f,a,c=n(e),s=n(r);if(c&&s){if((f=e.length)!=r.length)return!1;for(i=0;i<f;i++)if(!t(e[i],r[i]))return!1;return!0}if(c!=s)return!1;var l=e instanceof Date,d=r instanceof Date;if(l!=d)return!1;if(l&&d)return e.getTime()==r.getTime();var p=e instanceof RegExp,y=r instanceof RegExp;if(p!=y)return!1;if(p&&y)return e.toString()==r.toString();if(e instanceof Object&&r instanceof Object){var v=o(e);if((f=v.length)!==o(r).length)return!1;for(i=0;i<f;i++)if(!u.call(r,v[i]))return!1;for(i=0;i<f;i++)if(!t(e[a=v[i]],r[a]))return!1;return!0}return!1}},{}]},{},[1])(1)});