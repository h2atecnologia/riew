!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Rine=e()}}(function(){return function u(i,c,f){function a(t,e){if(!c[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[t]={exports:{}};i[t][0].call(o.exports,function(e){return a(i[t][1][e]||e)},o,o.exports,u,i,c,f)}return c[t].exports}for(var s="function"==typeof require&&require,e=0;e<f.length;e++)a(f[e]);return a}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.compose=n.merge=n.state=void 0;var r,o=e("./state"),u=e("./react"),i=(r=u)&&r.__esModule?r:{default:r},c=e("./utils");n.state=o.createState,n.merge=o.mergeStates,n.compose=c.compose,n.react={routine:i.default}},{"./react":2,"./state":4,"./utils":6}],2:[function(r,e,o){(function(e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var d=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,u=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw u}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};o.default=function(a){function t(e){var t=(0,p.useState)(null),n=d(t,2),r=n[0],o=n[1],u=(0,p.useState)({content:null,done:function(){}}),i=d(u,2),c=i[0],f=i[1];return(0,p.useEffect)(function(){r&&r.update(e)},[e]),(0,p.useEffect)(function(){r&&c.done()},[c]),(0,p.useEffect)(function(){return r=(0,m.default)(a,function(e,t){f(null===e?{content:null,done:t}:{content:y.default.createElement(s,e),done:t})}),null!==l&&r.withState(l),o(r),r.in(e),function(){r.out()}},[]),c.content}var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null},l=null;return t.displayName="Routine("+(0,n.getFuncName)(a)+")",t.withState=function(e){return l=e,t},t};var p="undefined"!=typeof window?window.React:void 0!==e?e.React:null,y=t(p),n=r("../utils"),m=t(r("../routine"));function t(e){return e&&e.__esModule?e:{default:e}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../routine":3,"../utils":6}],3:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var m="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:b,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:b,n={},r=!1,o=[],u=null,i=null,c=b,f=(0,h.createState)({}),a=f.mutate(function(e,t){return v({},e,t)}),s=(0,h.createState)({}),l=s.mutate(function(e,t){return v({},e,t)});function d(){return r}function p(){e(f.get(),c),c=b}function y(e,t){if(null===e||void 0!==e&&"object"!==(void 0===e?"undefined":m(e)))throw new Error("The routine's \""+t+'" method must be called with a key-value object. Instead "'+e+'" passed.')}return n.__states=function(){return i},n.isActive=d,n.in=function(e){return r=!0,y(e,"in"),l(e),a(null===u?{}:Object.keys(u).reduce(function(e,t){null===i&&(i={});var n=(0,h.isRineState)(u[t]),r=i[t]=n?u[t]:(0,h.createState)(u[t]);return n||o.push(r.teardown),r.stream.pipe(function(e){return a(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t,e))}),e[t]=r.get(),e},{})),t(Object.assign({render:function(t){return y(t,"render"),r?new Promise(function(e){c=e,a(t)}):Promise.resolve()},props:s,isActive:d},null!==i?v({},i):{})),s.stream(),f.stream.pipe(p),p(),n},n.update=l,n.out=function(){return o.forEach(function(e){return e()}),o=[],f.teardown(),i=null,r=!1,n},n.withState=function(e){return u=e,n},n};var h=e("./state");var b=function(){}},{"./state":4}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};n.createState=f,n.mergeStates=function(n){function e(){return Object.keys(n).reduce(function(e,t){return e[t]=n[t].get(),e},{})}var r=f(e());return r.set=function(t){if("object"!==(void 0===t?"undefined":o(t)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(t).forEach(function(e){n[e].set(t[e],!1)}),r.__triggerListeners()},r.get=e,Object.keys(n).forEach(function(e){n[e].stream.pipe(function(){r.__triggerListeners()})}),r},n.createStream=function(e){return f(e).stream},n.isRineState=function(e){return e&&!0===e.__rine};var u,d=e("./utils"),i=e("./system");(u=i)&&u.__esModule;function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var c=0,p=function(e){return"@@"+e+ ++c},l=["pipe","map","mutate","filter","parallel","cancel","mapToKey"];function y(s,e,t){var r=2<arguments.length&&void 0!==t?t:function(){},l={index:0,result:e(),id:p("q"),items:[],add:function(e,t){this.items.push({type:e,func:t,name:t.map(d.getFuncName)})},process:function(){for(var e=arguments.length,i=Array(e),t=0;t<e;t++)i[t]=arguments[t];var c=l.items,f=function(){return l.items=[]};function a(){return l.index++,l.index<c.length?n():(r(l),l.result)}function n(){var e=c[l.index],t=e.type,n=e.func;switch(t){case"pipe":var r=(n[0]||function(){}).apply(void 0,[l.result].concat(i));return(0,d.isPromise)(r)?r.then(a):a();case"map":return l.result=(n[0]||function(e){return e}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(e){return l.result=e,a()}):a();case"mapToKey":return l.result=function(e){return function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n[0],e)}.apply(void 0,[l.result].concat(i)),a();case"mutate":return l.result=(n[0]||function(e,t){return t}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(e){return l.result=e,s(l.result),a()}):(s(l.result),a());case"filter":var o=n[0].apply(n,[l.result].concat(i));return(0,d.isPromise)(o)?o.then(function(e){return e||(l.index=c.length),a()}):(o||(l.index=c.length),a());case"parallel":l.result=n.map(function(e){return e.apply(void 0,[l.result].concat(i))});var u=l.result.filter(d.isPromise);return 0<u.length?Promise.all(u).then(function(){return l.result.forEach(function(e,t){(0,d.isPromise)(e)&&e.then(function(e){return l.result[t]=e})}),a()}):a();case"cancel":return l.index=-1,f(),l.result}throw new Error('Unsupported method "'+t+'".')}return(l.index=0)<c.length?n():l.result},cancel:function(){this.items=[]}};return l}function f(e){var t=e,i={},c=[],f=[],a=!0;function n(e,u){l.forEach(function(o){e[o]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=function e(t){function o(){if(!1===a)return i.get();var r=y(i.set,i.get,function(n){return c=c.filter(function(e){var t=e.id;return n.id!==t})});return c.push(r),o.itemsToCreate.forEach(function(e){var t=e.type,n=e.func;return r.add(t,n)}),r.process.apply(r,arguments)}return o.itemsToCreate=[].concat(s(0<arguments.length&&void 0!==t?t:[])),l.forEach(function(r){o[r]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.itemsToCreate.push({type:r,func:t}),o}}),["set","get","teardown","stream"].forEach(function(e){o[e]=function(){throw new Error('"'+e+'" is not a queue method but a method of the state object.')}}),o.fork=function(){return e(o.itemsToCreate)},o.test=function(e){var r=o.fork(),n={setValue:function(e){r.itemsToCreate=[{type:"map",func:[function(){return e}]}].concat(s(r.itemsToCreate))},swap:function(e,t,n){Array.isArray(t)||(t=[t]),r.itemsToCreate[e].func=t,n&&(r.itemsToCreate[e].type=n)},swapFirst:function(e,t){n.swap(0,e,t)},swapLast:function(e,t){n.swap(r.itemsToCreate.length-1,e,t)}};return e(n),r},o}([{type:o,func:t}]);return u&&f.push(r),r}})}return i.__rine=!0,i.id=p("s"),i.__triggerListeners=function(){return f.forEach(function(e){return e()})},i.__listeners=function(){return f},i.__queues=function(){return c},i.active=function(){return a},i.get=function(){return t},i.set=function(e){t=e,1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||i.__triggerListeners()},i.teardown=function(){c.forEach(function(e){return e.cancel()}),c=[],a=!(f=[])},i.stream=function(){0<arguments.length?i.set(arguments.length<=0?void 0:arguments[0]):i.__triggerListeners()},n(i),n(i.stream,!0),i}},{"./system":5,"./utils":6}],5:[function(e,t,n){"use strict";function r(e){return{value:e.__get(),queues:e.__queues().map(function(e){return{index:e.index,result:e.result,items:e.items.map(function(e){var t=e.type;return e.name.join(",")+"("+t+")"})}})}}Object.defineProperty(n,"__esModule",{value:!0});var o={__states:[],onStateCreated:function(e){this.__states.push(e)},onStateTeardown:function(t){this.__states=this.__states.filter(function(e){return e.id===t.id})},snapshot:function(){return this.__states.map(r)}};n.default=o},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isGenerator=function(e){return e&&"function"==typeof e.next},n.isPromise=function(e){return e&&"function"==typeof e.then},n.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"},n.compose=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.forEach(function(e){return e.apply(void 0,t)})}}},{}]},{},[1])(1)});