!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Rine=e()}}(function(){return function u(i,c,f){function a(t,e){if(!c[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[t]={exports:{}};i[t][0].call(o.exports,function(e){return a(i[t][1][e]||e)},o,o.exports,u,i,c,f)}return c[t].exports}for(var s="function"==typeof require&&require,e=0;e<f.length;e++)a(f[e]);return a}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.compose=n.merge=n.state=void 0;var r,o=e("./state"),u=e("./react"),i=(r=u)&&r.__esModule?r:{default:r},c=e("./utils");n.state=o.createState,n.merge=o.mergeStates,n.compose=c.compose,n.react={routine:i.default}},{"./react":2,"./state":4,"./utils":5}],2:[function(r,e,o){(function(e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,u=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw u}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};o.default=function(d){function e(e){var t=(0,h.useState)(null),n=v(t,2),r=n[0],o=n[1],u=(0,h.useState)({content:null,done:function(){}}),i=v(u,2),c=i[0],f=i[1],a=(0,h.useState)({}),s=v(a,2),l=s[0],p=s[1];return(0,h.useEffect)(function(){r&&r.set(e)},[e]),(0,h.useEffect)(function(){r&&c.done()},[c]),(0,h.useEffect)(function(){return r=(0,_.default)(d,function(e,t){"string"==typeof e||"number"==typeof e||g.default.isValidElement(e)?f({content:e,done:t}):f(null===e?{content:null,done:t}:{content:g.default.createElement(y,function(e){return l=m({},l,e),p(l),l}(e)),done:t})}),o(r),r.in(e),function(){r.out()}},[]),c.content}var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null};return e.displayName="Routine("+(0,t.getFuncName)(d)+")",e};var h="undefined"!=typeof window?window.React:void 0!==e?e.React:null,g=n(h),t=r("../utils"),_=n(r("../routine"));function n(e){return e&&e.__esModule?e:{default:e}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../routine":3,"../utils":5}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t,n){var r=!1,o=[];function u(){return r}var i=(0,c.createState)({});return i.isActive=u,i.in=function(e){r=!0,i.set(e),t({render:function(t){return r?new Promise(function(e){n(t,e)}):Promise.resolve()},props:i,state:function(){var e=c.createState.apply(void 0,arguments);return o.push(e.teardown),e},isActive:u})},i.out=function(){r=!1,o.forEach(function(e){return e()}),o=[],i.teardown()},i};var c=e("./state")},{"./state":4}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};n.createState=i,n.mergeStates=function(n){function e(){return Object.keys(n).reduce(function(e,t){return e[t]=n[t].__get(),e},{})}var r=i(e());return r.__set=function(t){if("object"!==(void 0===t?"undefined":o(t)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(t).forEach(function(e){n[e].__set(t[e],!1)}),r.__triggerListeners()},r.__get=e,Object.keys(n).forEach(function(e){n[e].stream.pipe(function(){r.__triggerListeners()})}),r},n.createStream=function(e){return i(e).stream};var d=e("./utils");function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var u=0,l=function(e){return"@@"+e+ ++u},p=["pipe","map","mutate","filter","parallel","cancel","mapToKey"];function y(p,r,e){var o=2<arguments.length&&void 0!==e?e:function(){},u={id:l("q"),items:[],add:function(e,t){this.items.push({type:e,func:t})},process:function(){for(var e=arguments.length,i=Array(e),t=0;t<e;t++)i[t]=arguments[t];var c=0,f=r(),a=u.items,s=function(){return u.items=[]};function l(){return++c<a.length?n():(o(u),f)}function n(){var e=a[c],t=e.type,n=e.func;switch(t){case"pipe":var r=(n[0]||function(){}).apply(void 0,[f].concat(i));return(0,d.isPromise)(r)?r.then(l):l();case"map":return f=(n[0]||function(e){return e}).apply(void 0,[f].concat(i)),(0,d.isPromise)(f)?f.then(function(e){return f=e,l()}):l();case"mapToKey":return f=function(e){return function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n[0],e)}.apply(void 0,[f].concat(i)),l();case"mutate":return f=(n[0]||function(e,t){return t}).apply(void 0,[f].concat(i)),(0,d.isPromise)(f)?f.then(function(e){return p(f=e),l()}):(p(f),l());case"filter":var o=n[0].apply(n,[f].concat(i));return(0,d.isPromise)(o)?o.then(function(e){return e||(c=a.length),l()}):(o||(c=a.length),l());case"parallel":var u=(f=n.map(function(e){return e.apply(void 0,[f].concat(i))})).filter(d.isPromise);return 0<u.length?Promise.all(u).then(function(){return f.forEach(function(e,t){(0,d.isPromise)(e)&&e.then(function(e){return f[t]=e})}),l()}):l();case"cancel":return c=-1,s(),f}throw new Error('Unsupported method "'+t+'".')}return 0<a.length?n():f},cancel:function(){this.items=[]}};return u}function i(e){var t=e,i={},c=[],f=[],a=!0;function n(e,u){p.forEach(function(o){e[o]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=function e(t){function o(){if(!1===a)return i.__get();var r=y(i.__set,i.__get,function(n){return c=c.filter(function(e){var t=e.id;return n.id!==t})});return c.push(r),o.itemsToCreate.forEach(function(e){var t=e.type,n=e.func;return r.add(t,n)}),r.process.apply(r,arguments)}return o.itemsToCreate=[].concat(s(0<arguments.length&&void 0!==t?t:[])),p.forEach(function(r){o[r]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.itemsToCreate.push({type:r,func:t}),o}}),["set","get","teardown","stream"].forEach(function(e){o[e]=function(){throw new Error('"'+e+'" is not a queue method but a method of the state object.')}}),o.fork=function(){return e(o.itemsToCreate)},o.test=function(e){var r=o.fork(),n={setValue:function(e){r.itemsToCreate=[{type:"map",func:[function(){return e}]}].concat(s(r.itemsToCreate))},swap:function(e,t,n){Array.isArray(t)||(t=[t]),r.itemsToCreate[e].func=t,n&&(r.itemsToCreate[e].type=n)},swapFirst:function(e,t){n.swap(0,e,t)},swapLast:function(e,t){n.swap(r.itemsToCreate.length-1,e,t)}};return e(n),r},o}([{type:o,func:t}]);return u&&f.push(r),r}})}return i.id=l("s"),i.__get=function(){return t},i.__set=function(e){t=e,1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||i.__triggerListeners()},i.__triggerListeners=function(){return f.forEach(function(e){return e()})},i.__listeners=function(){return f},i.__queues=function(){return c},i.set=function(e){return i.__set(e)},i.get=function(){return i.map()()},i.teardown=function(){c.forEach(function(e){return e.cancel()}),c=[],a=!(f=[])},i.stream=function(){0<arguments.length?i.__set(arguments.length<=0?void 0:arguments[0]):i.__triggerListeners()},n(i),n(i.stream,!0),i}},{"./utils":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isGenerator=function(e){return e&&"function"==typeof e.next},n.isPromise=function(e){return e&&"function"==typeof e.then},n.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"},n.compose=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.forEach(function(e){return e.apply(void 0,t)})}}},{}]},{},[1])(1)});