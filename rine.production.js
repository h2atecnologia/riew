!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).rine=e()}}(function(){return function i(o,a,f){function c(t,e){if(!a[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var u=a[t]={exports:{}};o[t][0].call(u.exports,function(e){return c(o[t][1][e]||e)},u,u.exports,i,o,a,f)}return a[t].exports}for(var s="function"==typeof require&&require,e=0;e<f.length;e++)c(f[e]);return c}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});function r(e){if(u[e])return u[e];throw new Error('Rine registry: missing "'+e+'".')}var u={},i={__resolver:r,set:function(e,t){u[e]=t},get:function(e){return this.__resolver(e)},getBulk:function(e){var n=this;return e.reduce(function(e,t){return e[t]=n.get(t),e},{})},remove:function(e){delete u[e]},resolver:function(e){this.__resolver=e},reset:function(){u={},this.__resolver=r}};n.default=i},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=0;function i(e,t,n){var r={__rine:"task",id:"@@t"+ ++u,active:!0,once:!(2<arguments.length&&void 0!==n)||n,type:e,callback:t,done:null,cancel:function(){this.active=!1,o.removeTask(this)},execute:function(e,t){this.active&&(t?this.callback(e,t):this.callback(e),this.once&&o.removeTask(this))}};return t||(r.done=new Promise(function(e){r.callback=e})),r}var o={tasks:[],addTask:function(e,t,n){var r=i(e,t,n);return this.tasks.push(r),r},removeTask:function(t){this.tasks=this.tasks.filter(function(e){return e.id!==t.id})},put:function(t,n){this.tasks.forEach(function(e){e.type===t?e.execute(n):"*"===e.type&&e.execute(n,t)})},take:function(e,t){var n=this;return Array.isArray(e)?e.map(function(e){return n.addTask(e,t,!0)}):this.addTask(e,t,!0)},takeEvery:function(e,t){var n=this;return Array.isArray(e)?e.map(function(e){return n.addTask(e,t,!1)}):this.addTask(e,t,!1)},reset:function(){this.tasks=[]},isTask:function(e){return e&&"task"===e.__rine},putBulk:function(e){var t=this;e.forEach(function(e){return t.put(e)})}};n.default=o},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};n.default=function(r,u){var e=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=function(r){return Object.keys(r).reduce(function(e,t){var n=r[t];return f(n)?e[t]=c(n):e[t]=n,e},{})}(r);!1===e&&u(i);var t=Object.keys(r).map(function(t){var e=r[t];if(f(e)){var n=e;return n.subscribe(function(){var e=c(n);(0,a.default)(i[t],e)||u(i=o({},i,function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({},t,e)))})}}).filter(function(e){return!!e});return function(){return t.forEach(function(e){return e()})}};var r,u=e("fast-deep-equal"),a=(r=u)&&r.__esModule?r:{default:r};function f(e){return"state"===e.__rine}function c(e){return e()}},{"fast-deep-equal":8}],4:[function(o,e,a){(function(e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,u=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){u=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(u)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};a.createRoutineInstance=i,a.default=function(c){function r(e){var t=(0,v.useState)(null),n=p(t,2),r=n[0],u=n[1],i=(0,v.useState)(null),o=p(i,2),a=o[0],f=o[1];return(0,v.useEffect)(function(){r&&r.updated(e)},[e]),(0,v.useEffect)(function(){r&&r.rendered()},[a]),(0,v.useEffect)(function(){return u(r=l.createRoutineInstance(c,d)),r.in(e,s,f),function(){r.out(),h.default.put(k(r.id))}},[]),a}var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null},l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{createRoutineInstance:i},d=[];return r.displayName="Routine("+(0,n.getFuncName)(c)+")",r.inject=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return d=u.default.getBulk(t),r},r};var v="undefined"!=typeof window?window.React:void 0!==e?e.React:null,y=t(v),h=t(o("./System")),n=o("../utils"),b=o("./state"),g=t(b),m=t(o("./connect")),u=t(o("./Registry"));function t(e){return e&&e.__esModule?e:{default:e}}var r=0,_=function(){return"@@r"+ ++r},k=function(e){return e+"_unmounted"};function i(r,u){var e=_(),i=!1,o=(0,g.default)(),a={},f=[],c=[(0,b.teardownAction)(o.id)],s=void 0;function l(){return i}var t={__rine:"routine",id:e,name:(0,n.getFuncName)(r),isMounted:l,in:function(e,t,n){i=!0,o.set(e),r(d({},u,{render:function(e){return i?("string"==typeof e||"number"==typeof e||y.default.isValidElement(e)?n(e):n(null===e?function(){return null}:y.default.createElement(t,function(e){return a=d({},a,e)}(e))),new Promise(function(e){return s=e})):Promise.resolve()},useProps:function(e){o.subscribe(e),e(o())},put:function(){return h.default.put.apply(h.default,arguments)},take:function(){var e=h.default.take.apply(h.default,arguments);return Array.isArray(e)?(f=f.concat(e.map(function(e){return function(){return e.cancel()}})),e[0].done?Promise.all(e.map(function(e){return e.done})):e):(f.push(function(){return e.cancel()}),e.done)},takeEvery:function(){var e=h.default.takeEvery.apply(h.default,arguments);return Array.isArray(e)?f=f.concat(e.map(function(e){return function(){return e.cancel()}})):f.push(function(){return e.cancel()}),e},state:function(){var e=g.default.apply(void 0,arguments);return c.push((0,b.teardownAction)(e.id)),e},connect:function(){f.push(m.default.apply(void 0,arguments))},isMounted:l}))},updated:function(e){o.set(e)},rendered:function(){s&&s()},out:function(){i=!1}};return h.default.addTask(k(e),function(){f.forEach(function(e){return e()}),h.default.putBulk(c)}),t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils":7,"./Registry":1,"./System":2,"./connect":3,"./state":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isState=n.teardownAction=void 0,n.default=function(e){function t(e){return void 0!==e&&t.set(e),t.get()}function i(e){t.set(e),f=!1,c()}var n=0,o=e,r=[],u=[],a=[],f=!1,c=function(){if(0!==a.length&&!f){f=!0;var e=a.shift(),t=e.reducer,n=e.payload,r=e.done,u=t(o,n);(0,l.isPromise)(u)?u.then(function(e){r(e),i(e)}):(r(u),i(u))}};return t.__rine="state",t.__subscribers=function(){return r},t.id=d(),t.set=function(e){return o=e,r.forEach(function(e){return(0,e.update)(o)}),e},t.get=function(){return o},t.subscribe=function(e){var t=++n;return r.push({id:t,update:e}),function(){r=r.filter(function(e){return e.id!==t})}},t.teardown=function(){s.default.put(p(t.id))},t.mutation=function(n){for(var e=arguments.length,t=Array(1<e?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return 0<t.length&&t.forEach(function(e){u.push(s.default.takeEvery(e,function(e){a.push({reducer:n,payload:e,done:function(){}}),c()}))}),function(t){return new Promise(function(e){a.push({reducer:n,payload:t,done:e}),c()})}},s.default.addTask(p(t.id),function(){r=[],o=void 0,0<u.length&&u.forEach(function(e){return e.cancel()})}),t};var r,u=e("./System"),s=(r=u)&&r.__esModule?r:{default:r},l=e("../utils");var i=0,d=function(){return"@@s"+ ++i},p=n.teardownAction=function(e){return e+"_teardown"};n.isState=function(e){return e&&"state"===e.__rine}},{"../utils":7,"./System":2}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resolver=n.register=n.takeEvery=n.take=n.put=n.connect=n.state=n.rine=n.System=void 0;var r=e("./api/System");Object.defineProperty(n,"System",{enumerable:!0,get:function(){return c(r).default}});var u=e("./api/routine");Object.defineProperty(n,"rine",{enumerable:!0,get:function(){return c(u).default}});var i=e("./api/state");Object.defineProperty(n,"state",{enumerable:!0,get:function(){return c(i).default}});var o=e("./api/connect");Object.defineProperty(n,"connect",{enumerable:!0,get:function(){return c(o).default}});var a=c(r),f=c(e("./api/Registry"));function c(e){return e&&e.__esModule?e:{default:e}}n.put=a.default.put.bind(a.default),n.take=a.default.take.bind(a.default),n.takeEvery=a.default.takeEvery.bind(a.default),n.register=f.default.set.bind(f.default),n.resolver=f.default.resolver.bind(f.default)},{"./api/Registry":1,"./api/System":2,"./api/connect":3,"./api/routine":4,"./api/state":5}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isGenerator=function(e){return e&&"function"==typeof e.next},n.isPromise=function(e){return e&&"function"==typeof e.then},n.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"}},{}],8:[function(e,t,n){"use strict";var p=Array.isArray,v=Object.keys,y=Object.prototype.hasOwnProperty;t.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){var r,u,i,o=p(t),a=p(n);if(o&&a){if((u=t.length)!=n.length)return!1;for(r=u;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(o!=a)return!1;var f=t instanceof Date,c=n instanceof Date;if(f!=c)return!1;if(f&&c)return t.getTime()==n.getTime();var s=t instanceof RegExp,l=n instanceof RegExp;if(s!=l)return!1;if(s&&l)return t.toString()==n.toString();var d=v(t);if((u=d.length)!==v(n).length)return!1;for(r=u;0!=r--;)if(!y.call(n,d[r]))return!1;for(r=u;0!=r--;)if(!e(t[i=d[r]],n[i]))return!1;return!0}return t!=t&&n!=n}},{}]},{},[6])(6)});