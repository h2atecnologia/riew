!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Rine=t()}}(function(){return function u(i,c,f){function a(e,t){if(!c[e]){if(!i[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(s)return s(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[e]={exports:{}};i[e][0].call(o.exports,function(t){return a(i[e][1][t]||t)},o,o.exports,u,i,c,f)}return c[e].exports}for(var s="function"==typeof require&&require,t=0;t<f.length;t++)a(f[t]);return a}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.compose=n.merge=n.state=void 0;var r,o=t("./state"),u=t("./react"),i=(r=u)&&r.__esModule?r:{default:r},c=t("./utils");n.state=o.createState,n.merge=o.mergeStates,n.compose=c.compose,n.react={routine:i.default}},{"./react":2,"./state":4,"./utils":5}],2:[function(r,t,o){(function(t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},g=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,u=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,u=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw u}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};o.default=function(p){function t(t){var e=(0,v.useState)(null),n=g(e,2),r=n[0],o=n[1],u=(0,v.useState)({content:null,done:function(){}}),i=g(u,2),c=i[0],f=i[1],a=(0,v.useState)({}),s=g(a,2),l=s[0],d=s[1];return(0,v.useEffect)(function(){r&&r.set(t)},[t]),(0,v.useEffect)(function(){r&&c.done()},[c]),(0,v.useEffect)(function(){return r=(0,_.default)(p,function(t,e){"string"==typeof t||"number"==typeof t||h.default.isValidElement(t)?f({content:t,done:e}):f(null===t?{content:null,done:e}:{content:h.default.createElement(y,function(t){return l=m({},l,t),d(l),l}(t)),done:e})}),o(r),r.in(t),function(){r.out()}},[]),c.content}var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null};return t.displayName="Routine("+(0,e.getFuncName)(p)+")",t};var v="undefined"!=typeof window?window.React:void 0!==t?t.React:null,h=n(v),e=r("../utils"),_=n(r("../routine"));function n(t){return t&&t.__esModule?t:{default:t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../routine":3,"../utils":5}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,n){var r=!1,o=[];function u(){return r}var i=(0,c.createState)({});return i.isActive=u,i.in=function(t){r=!0,i.set(t),e({render:function(e){return r?new Promise(function(t){n(e,t)}):Promise.resolve()},props:i.stream,state:function(){var t=c.createState.apply(void 0,arguments);return o.push(t.teardown),t},isActive:u})},i.out=function(){r=!1,o.forEach(function(t){return t()}),o=[],i.teardown()},i};var c=t("./state")},{"./state":4}],4:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)};n.createState=c,n.mergeStates=function(n){function t(){return Object.keys(n).reduce(function(t,e){return t[e]=n[e].__get(),t},{})}var r=c(t());return r.__set=function(e){if("object"!==(void 0===e?"undefined":o(e)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(e).forEach(function(t){n[t].__set(e[t],!1)}),r.__triggerListeners()},r.__get=t,Object.keys(n).forEach(function(t){n[t].stream.pipe(function(){r.__triggerListeners()})}),r};var p=t("./utils");function u(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var i=0,f=function(){return"@@s"+ ++i},a=["pipe","map","mutate","filter","parallel","cancel","mapToKey"];function s(d,r,t,e){var n=3<arguments.length&&void 0!==e?e:function(){},o={items:[].concat(u(2<arguments.length&&void 0!==t?t:[])),add:function(t,e){this.items.push({type:t,func:e})},trigger:function(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];var c=0,f=r(),a=o.items,s=function(){return o.items=[]};function l(){return++c<a.length?n():f}function n(){var t=a[c],e=t.type,n=t.func;switch(e){case"pipe":var r=(n[0]||function(){}).apply(void 0,[f].concat(i));return(0,p.isPromise)(r)?r.then(l):l();case"map":return f=(n[0]||function(t){return t}).apply(void 0,[f].concat(i)),(0,p.isPromise)(f)?f.then(function(t){return f=t,l()}):l();case"mapToKey":return f=function(t){return function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},n[0],t)}.apply(void 0,[f].concat(i)),l();case"mutate":return f=(n[0]||function(t,e){return e}).apply(void 0,[f].concat(i)),(0,p.isPromise)(f)?f.then(function(t){return d(f=t),l()}):(d(f),l());case"filter":var o=n[0].apply(n,[f].concat(i));return(0,p.isPromise)(o)?o.then(function(t){return t||(c=a.length),l()}):(o||(c=a.length),l());case"parallel":var u=(f=n.map(function(t){return t.apply(void 0,[f].concat(i))})).filter(p.isPromise);return 0<u.length?Promise.all(u).then(function(){return f.forEach(function(t,e){(0,p.isPromise)(t)&&t.then(function(t){return f[e]=t})}),l()}):l();case"cancel":return c=-1,s(),f}throw new Error('Unsupported method "'+e+'".')}return 0<a.length?n():f},cancel:function(){this.items=[]},clone:function(){return s(d,r,o.items.map(function(t){return{type:t.type,func:t.func}}),n)}};return a.forEach(function(r){o.trigger[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return o.add(r,e),o.trigger}}),o.trigger.fork=function(){return o.clone().trigger},o.trigger.test=function(t){var r=o.clone(),n={setValue:function(t){r.items=[{type:"map",func:[function(){return t}]}].concat(u(r.items))},swap:function(t,e,n){Array.isArray(e)||(e=[e]),r.items[t].func=e,n&&(r.items[t].type=n)},swapFirst:function(t,e){n.swap(0,t,e)},swapLast:function(t,e){n.swap(r.items.length-1,t,e)}};return t(n),r.trigger},["set","get","teardown","stream"].forEach(function(t){o.trigger[t]=function(){throw new Error('"'+t+'" is not a queue method but a method of the state object.')}}),n(o),o}function c(t){var e=t,u={},i=[],c=[];return u.__id=f(),u.__get=function(){return e},u.__set=function(t){e=t,1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||u.__triggerListeners()},u.__triggerListeners=function(){return c.forEach(function(t){return t()})},u.__listeners=function(){return c},u.__queues=function(){return i},u.set=function(t){return u.__set(t)},u.get=function(){return u.map()()},u.teardown=function(){i.forEach(function(t){return t.cancel()}),i=[],c=[]},u.stream=function(){return u.__get()},a.forEach(function(o){u[o]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=s(u.__set,u.__get,[],function(t){i.push(t)});return r.add(o,e),r.trigger}}),a.forEach(function(o){u.stream[o]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=s(u.__set,u.__get,[],function(t){i.push(t),c.push(t.trigger)});return r.add(o,e),r.trigger}}),u}},{"./utils":5}],5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isGenerator=function(t){return t&&"function"==typeof t.next},n.isPromise=function(t){return t&&"function"==typeof t.then},n.getFuncName=function(t){if(t.name)return t.name;var e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:"unknown"},n.compose=function(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];return function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.forEach(function(t){return t.apply(void 0,e)})}}},{}]},{},[1])(1)});