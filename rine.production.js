!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Rine=e()}}(function(){return function o(i,a,c){function f(t,e){if(!a[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var u=a[t]={exports:{}};i[t][0].call(u.exports,function(e){return f(i[t][1][e]||e)},u,u.exports,o,i,a,c)}return a[t].exports}for(var s="function"==typeof require&&require,e=0;e<c.length;e++)f(c[e]);return f}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.compose=n.merge=n.state=void 0;var r,u=e("./state"),o=e("./react"),i=(r=o)&&r.__esModule?r:{default:r},a=e("./utils");n.state=u.createState,n.merge=u.mergeStates,n.compose=a.compose,n.react={routine:i.default}},{"./react":2,"./state":4,"./utils":6}],2:[function(r,e,u){(function(e){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,u=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){u=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(u)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};u.default=function(p){function e(e){var t=(0,h.useState)(null),n=v(t,2),r=n[0],u=n[1],o=(0,h.useState)({content:null,done:function(){}}),i=v(o,2),a=i[0],c=i[1],f=(0,h.useState)({}),s=v(f,2),l=s[0],d=s[1];return(0,h.useEffect)(function(){r&&r.set(e)},[e]),(0,h.useEffect)(function(){r&&a.done()},[a]),(0,h.useEffect)(function(){return r=(0,g.default)(p,function(e,t){"string"==typeof e||"number"==typeof e||_.default.isValidElement(e)?c({content:e,done:t}):c(null===e?{content:null,done:t}:{content:_.default.createElement(y,function(e){return l=m({},l,e),d(l),l}(e)),done:t})}),u(r),r.in(e),function(){r.out()}},[]),a.content}var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null};return e.displayName="Routine("+(0,t.getFuncName)(p)+")",e};var h="undefined"!=typeof window?window.React:void 0!==e?e.React:null,_=n(h),t=r("../utils"),g=n(r("../routine"));function n(e){return e&&e.__esModule?e:{default:e}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../routine":3,"../utils":6}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:c,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c,r=!1,u=[];function o(){return r}var i=(0,a.createState)({});return i.isActive=o,i.in=function(e){r=!0,i.set(e),n(e,c),t({render:function(t){return r?new Promise(function(e){n(t,e)}):Promise.resolve()},props:i,state:function(){var e=a.createState.apply(void 0,arguments);return u.push(e.teardown),e},isActive:o})},i.out=function(){r=!1,u.forEach(function(e){return e()}),u=[],i.teardown()},i};var a=e("./state"),c=function(){}},{"./state":4}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};n.createState=c,n.mergeStates=function(n){function e(){return Object.keys(n).reduce(function(e,t){return e[t]=n[t].__get(),e},{})}var r=c(e());return r.__set=function(t){if("object"!==(void 0===t?"undefined":u(t)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(t).forEach(function(e){n[e].__set(t[e],!1)}),r.__triggerListeners()},r.__get=e,Object.keys(n).forEach(function(e){n[e].stream.pipe(function(){r.__triggerListeners()})}),r},n.createStream=function(e){return c(e).stream};var o,d=e("./utils"),i=e("./system");(o=i)&&o.__esModule;function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=0,p=function(e){return"@@"+e+ ++a},l=["pipe","map","mutate","filter","parallel","cancel","mapToKey"];function y(s,e,t){var r=2<arguments.length&&void 0!==t?t:function(){},l={index:0,result:e(),id:p("q"),items:[],add:function(e,t){this.items.push({type:e,func:t,name:t.map(d.getFuncName)})},process:function(){for(var e=arguments.length,i=Array(e),t=0;t<e;t++)i[t]=arguments[t];var a=l.items,c=function(){return l.items=[]};function f(){return l.index++,l.index<a.length?n():(r(l),l.result)}function n(){var e=a[l.index],t=e.type,n=e.func;switch(t){case"pipe":var r=(n[0]||function(){}).apply(void 0,[l.result].concat(i));return(0,d.isPromise)(r)?r.then(f):f();case"map":return l.result=(n[0]||function(e){return e}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(e){return l.result=e,f()}):f();case"mapToKey":return l.result=function(e){return function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n[0],e)}.apply(void 0,[l.result].concat(i)),f();case"mutate":return l.result=(n[0]||function(e,t){return t}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(e){return l.result=e,s(l.result),f()}):(s(l.result),f());case"filter":var u=n[0].apply(n,[l.result].concat(i));return(0,d.isPromise)(u)?u.then(function(e){return e||(l.index=a.length),f()}):(u||(l.index=a.length),f());case"parallel":l.result=n.map(function(e){return e.apply(void 0,[l.result].concat(i))});var o=l.result.filter(d.isPromise);return 0<o.length?Promise.all(o).then(function(){return l.result.forEach(function(e,t){(0,d.isPromise)(e)&&e.then(function(e){return l.result[t]=e})}),f()}):f();case"cancel":return l.index=-1,c(),l.result}throw new Error('Unsupported method "'+t+'".')}return(l.index=0)<a.length?n():l.result},cancel:function(){this.items=[]}};return l}function c(e){var t=e,i={},a=[],c=[],f=!0;function n(e,o){l.forEach(function(u){e[u]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=function e(t){function u(){if(!1===f)return i.__get();var r=y(i.__set,i.__get,function(n){return a=a.filter(function(e){var t=e.id;return n.id!==t})});return a.push(r),u.itemsToCreate.forEach(function(e){var t=e.type,n=e.func;return r.add(t,n)}),r.process.apply(r,arguments)}return u.itemsToCreate=[].concat(s(0<arguments.length&&void 0!==t?t:[])),l.forEach(function(r){u[r]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return u.itemsToCreate.push({type:r,func:t}),u}}),["set","get","teardown","stream"].forEach(function(e){u[e]=function(){throw new Error('"'+e+'" is not a queue method but a method of the state object.')}}),u.fork=function(){return e(u.itemsToCreate)},u.test=function(e){var r=u.fork(),n={setValue:function(e){r.itemsToCreate=[{type:"map",func:[function(){return e}]}].concat(s(r.itemsToCreate))},swap:function(e,t,n){Array.isArray(t)||(t=[t]),r.itemsToCreate[e].func=t,n&&(r.itemsToCreate[e].type=n)},swapFirst:function(e,t){n.swap(0,e,t)},swapLast:function(e,t){n.swap(r.itemsToCreate.length-1,e,t)}};return e(n),r},u}([{type:u,func:t}]);return o&&c.push(r),r}})}return i.id=p("s"),i.__get=function(){return t},i.__set=function(e){t=e,1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||i.__triggerListeners()},i.__triggerListeners=function(){return c.forEach(function(e){return e()})},i.__listeners=function(){return c},i.__queues=function(){return a},i.set=function(e){return i.__set(e)},i.get=function(){return i.map()()},i.teardown=function(){a.forEach(function(e){return e.cancel()}),a=[],f=!(c=[])},i.stream=function(){0<arguments.length?i.__set(arguments.length<=0?void 0:arguments[0]):i.__triggerListeners()},n(i),n(i.stream,!0),i}},{"./system":5,"./utils":6}],5:[function(e,t,n){"use strict";function r(e){return{value:e.__get(),queues:e.__queues().map(function(e){return{index:e.index,result:e.result,items:e.items.map(function(e){var t=e.type;return e.name.join(",")+"("+t+")"})}})}}Object.defineProperty(n,"__esModule",{value:!0});var u={__states:[],onStateCreated:function(e){this.__states.push(e)},onStateTeardown:function(t){this.__states=this.__states.filter(function(e){return e.id===t.id})},snapshot:function(){return this.__states.map(r)}};n.default=u},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isGenerator=function(e){return e&&"function"==typeof e.next},n.isPromise=function(e){return e&&"function"==typeof e.then},n.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"},n.compose=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.forEach(function(e){return e.apply(void 0,t)})}}},{}]},{},[1])(1)});