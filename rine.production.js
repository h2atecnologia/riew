!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Rine=e()}}(function(){return function u(i,c,f){function a(t,e){if(!c[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[t]={exports:{}};i[t][0].call(o.exports,function(e){return a(i[t][1][e]||e)},o,o.exports,u,i,c,f)}return c[t].exports}for(var s="function"==typeof require&&require,e=0;e<f.length;e++)a(f[e]);return a}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.compose=n.merge=n.state=void 0;var r,o=e("./state"),u=e("./react"),i=(r=u)&&r.__esModule?r:{default:r},c=e("./utils");n.state=o.createState,n.merge=o.mergeStates,n.compose=c.compose,n.react={routine:i.default}},{"./react":2,"./state":4,"./utils":5}],2:[function(r,e,o){(function(e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,u=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw u}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};o.default=function(p){function e(e){var t=(0,h.useState)(null),n=m(t,2),r=n[0],o=n[1],u=(0,h.useState)({content:null,done:function(){}}),i=m(u,2),c=i[0],f=i[1],a=(0,h.useState)({}),s=m(a,2),l=s[0],d=s[1];return(0,h.useEffect)(function(){r&&r.set(e)},[e]),(0,h.useEffect)(function(){r&&c.done()},[c]),(0,h.useEffect)(function(){return r=(0,_.default)(p,function(e,t){"string"==typeof e||"number"==typeof e||g.default.isValidElement(e)?f({content:e,done:t}):f(null===e?{content:null,done:t}:{content:g.default.createElement(y,function(e){return l=v({},l,e),d(l),l}(e)),done:t})}),o(r),r.in(e),function(){r.out()}},[]),c.content}var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null};return e.displayName="Routine("+(0,t.getFuncName)(p)+")",e};var h="undefined"!=typeof window?window.React:void 0!==e?e.React:null,g=n(h),t=r("../utils"),_=n(r("../routine"));function n(e){return e&&e.__esModule?e:{default:e}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../routine":3,"../utils":5}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t,n){var r=!1,o=[];function u(){return r}var i=(0,c.createState)({});return i.isActive=u,i.in=function(e){r=!0,i.set(e),t({render:function(t){return r?new Promise(function(e){n(t,e)}):Promise.resolve()},props:i.stream,state:function(){var e=c.createState.apply(void 0,arguments);return o.push(e.teardown),e},isActive:u})},i.out=function(){r=!1,o.forEach(function(e){return e()}),o=[],i.teardown()},i};var c=e("./state")},{"./state":4}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)};n.createState=i,n.mergeStates=function(n){function e(){return Object.keys(n).reduce(function(e,t){return e[t]=n[t].__get(),e},{})}var t=i(e());return t.__set=function(t){if("object"!==(void 0===t?"undefined":o(t)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(t).forEach(function(e){n[e].__set(t[e])})},t.__get=e,Object.keys(n).forEach(function(e){n[e].stream.pipe(t.__triggerListeners)}),t};var y=e("./utils");function v(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var u=0,f=function(){return"@@s"+ ++u},a=function e(d,t,n){var p=[].concat(v(2<arguments.length&&void 0!==n?n:[]));return{add:function(e,t){p.push({type:e,func:t})},process:function(f){var a=0,s=t();function l(){return++a<p.length?e():s}function e(){var e=p[a],t=e.type,n=e.func;switch(t){case"pipe":var r=(n[0]||function(){}).apply(void 0,[s].concat(v(f)));return(0,y.isPromise)(r)?r.then(l):l();case"map":return s=(n[0]||function(e){return e}).apply(void 0,[s].concat(v(f))),(0,y.isPromise)(s)?s.then(function(e){return s=e,l()}):l();case"mapToKey":return s=function(e){return function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n[0],e)}.apply(void 0,[s].concat(v(f))),l();case"mutate":return s=(n[0]||function(e,t){return t}).apply(void 0,[s].concat(v(f))),(0,y.isPromise)(s)?s.then(function(e){return d(s=e),l()}):(d(s),l());case"filter":var o=n[0].apply(n,[s].concat(v(f)));return(0,y.isPromise)(o)?o.then(function(e){return e||(a=p.length),l()}):(o||(a=p.length),l());case"parallel":var u=(s=n.map(function(e){return e.apply(void 0,[s].concat(v(f)))})).filter(y.isPromise);return 0<u.length?Promise.all(u).then(function(){return s.forEach(function(e,t){(0,y.isPromise)(e)&&e.then(function(e){return s[t]=e})}),l()}):l();case"branch":var i=n[0].apply(n,[s].concat(v(f))),c=function(e){if(e){var t=n[1].apply(n,[s].concat(v(f)));return a=p.length,(0,y.isPromise)(t)?t.then(l):l()}return l()};return(0,y.isPromise)(i)?i.then(c):c(i);case"cancel":return a=-1,p=[],s}throw new Error('Unsupported method "'+t+'".')}return 0<p.length?e():s},cancel:function(){p=[]},clone:function(){return e(d,t,p)}}};function i(e){function i(e,t){function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return u.process(t)}var u=a(r.__set,r.__get);return u.add(e,t),o.fork=function(){return i(e,t)},n.forEach(function(r){o[r]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return u.add(r,t),o}}),c.push(u),o}var t=e,n=["pipe","map","mutate","filter","parallel","branch","cancel","mapToKey"],r={},c=[],u=[];return r.__id=f(),r.__get=function(){return t},r.__set=function(e){t=e,r.__triggerListeners()},r.__triggerListeners=function(){return u.forEach(function(e){return e()})},r.__listeners=function(){return u},r.__queues=function(){return c},r.set=function(e){return r.mutate()(e)},r.get=function(){return r.map()()},r.teardown=function(){n.forEach(function(e){return r[e]=function(){}}),c.forEach(function(e){return e.cancel()}),c=[],u=[]},r.stream=function(){return r.__get()},n.forEach(function(o){r[o]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return i(o,t)},r.stream[o]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=i(o,t);return u.push(r),r}}),r}},{"./utils":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isGenerator=function(e){return e&&"function"==typeof e.next},n.isPromise=function(e){return e&&"function"==typeof e.then},n.getFuncName=function(e){if(e.name)return e.name;var t=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return t?t[1]:"unknown"},n.compose=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.forEach(function(e){return e.apply(void 0,t)})}}},{}]},{},[1])(1)});