!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Rine=t()}}(function(){return function u(i,a,c){function f(e,t){if(!a[e]){if(!i[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(s)return s(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[e]={exports:{}};i[e][0].call(o.exports,function(t){return f(i[e][1][t]||t)},o,o.exports,u,i,a,c)}return a[e].exports}for(var s="function"==typeof require&&require,t=0;t<c.length;t++)f(c[t]);return f}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.routine=n.merge=n.state=void 0;var r=t("./state"),o=i(t("./routine")),u=i(t("./react"));function i(t){return t&&t.__esModule?t:{default:t}}n.state=r.createState,n.merge=r.mergeStates,n.routine=o.default,n.react={routine:u.default}},{"./react":2,"./routine":3,"./state":4}],2:[function(n,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var y=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,u=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,u=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw u}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.default=function(l,d){void 0===d&&(d=l,l=function(){});return function e(t,n){function r(t){var e=(0,p.useState)(null),n=y(e,2),r=n[0],o=n[1],u=(0,p.useState)({content:null,done:function(){}}),i=y(u,2),a=i[0],c=i[1];return(0,p.useEffect)(function(){r&&r.update(t)},[t]),(0,p.useEffect)(function(){r&&a.done()},[a]),(0,p.useEffect)(function(){return r=(0,v.default)(l,function(t,e){c(null===t?{content:null,done:e}:{content:m.default.createElement(d,t),done:e})}),null!==f&&(r=r.with(f)),null!==s&&(r=r.withState(s)),o(r),r.in(t),function(){r.out()}},[]),a.content}var f=0<arguments.length&&void 0!==t?t:null,s=1<arguments.length&&void 0!==n?n:null;return r.displayName="Routine("+(0,o.getFuncName)(l)+")",r.with=function(t){return e(t)},r.withState=function(t){return e(null,t)},r}()};var p="undefined"!=typeof window?window.React:void 0!==t?t.React:null,m=e(p),o=n("../utils"),v=e(n("../routine"));function e(t){return t&&t.__esModule?t:{default:t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../routine":3,"../utils":5}],3:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0});var g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},b="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)};n.default=function e(r,o){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};void 0===o&&(o=r,r=S);var n={};var u=!1;var a=function(){return u};var c=[];var f=S;var s=(0,_.createState)({});var l=s.mutate(function(t,e){return g({},t,e)});var d=(0,_.createState)({});var y=d.mutate(function(t,e){return g({},t,e)});var p=(0,_.createState)({render:function(e){return E(e,"render"),u?new Promise(function(t){f=t,y(e)}):Promise.resolve()},props:s,isActive:a});var m=p.mutate(function(t,e){return g({},t,e)});function v(){o(d.get(),f),f=S}function h(){Object.keys(i).forEach(function(e){var t=(0,_.isRineState)(i[e]),n=(0,_.isRineQueueTrigger)(i[e]),r=void 0;if(t)r=i[e],m(w({},e,r)),y(w({},e,r.get())),r.stream.pipe(function(t){return y(w({},e,t))});else if(n){var o=i[e];if(o.__activity()===_.MUTABLE)throw new Error("Triggers that mutate state can not be sent to the routine. This area is meant only for triggers that fetch data. If you need to pass such triggers use the controller to do that.");o.__state.stream.filter(a).pipe(function(){return y(w({},e,o()))})()}else if("$"===e.charAt(0)){var u=e.substr(1,e.length);r=(0,_.createState)(i[e]),c.push(r.teardown),m(w({},u,r)),y(w({},u,r.get())),r.stream.filter(a).pipe(function(t){return y(w({},u,t))})}else m(w({},e,i[e])),y(w({},e,i[e]))})}n.isActive=a;n.in=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u=!0,E(t,"in"),l(t),h();var e=r(p.get());if(e){if("object"!==(void 0===e?"undefined":b(e)))throw new Error("You must return a key-value object from your controller.");y(e)}return s.stream(),d.stream.pipe(v)(),n};n.update=l;n.out=function(){return c.forEach(function(t){return t()}),c=[],s.teardown(),d.teardown(),p.teardown(),u=!1,n};n.with=function(t){return e(r,o,g({},i,t))};n.withState=function(n){return e(r,o,Object.keys(n).reduce(function(t,e){return t["$"+e]=n[e],t},i))};n.test=function(t){return e(r,o,g({},i,t))};return n};var _=t("./state");function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S(){}function E(t,e){if(null===t||void 0!==t&&"object"!==(void 0===t?"undefined":b(t)))throw new Error("The routine's \""+e+'" method must be called with a key-value object. Instead "'+t+'" passed.')}},{"./state":4}],4:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0}),n.MUTABLE=n.IMMUTABLE=void 0;var o="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)};n.createState=c,n.mergeStates=function(n){function t(){return Object.keys(n).reduce(function(t,e){return t[e]=n[e].get(),t},{})}var r=c(t());return r.set=function(e){if("object"!==(void 0===e?"undefined":o(e)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(e).forEach(function(t){n[t].set(e[t],!1)}),r.__triggerListeners()},r.get=t,Object.keys(n).forEach(function(t){n[t].stream.pipe(function(){r.__triggerListeners()})}),r},n.createStream=function(t){return c(t).stream},n.isRineState=function(t){return t&&!0===t.__rine},n.isRineQueueTrigger=function(t){return t&&!0===t.__rineTrigger};var d=t("./utils");function p(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var i=n.IMMUTABLE="IMMUTABLE",a=n.MUTABLE="MUTABLE",u=0,m=function(t){return"@@"+t+ ++u},v=["pipe","map","mutate","filter","parallel","cancel","mapToKey"],h=function(t){var e=!0,n=!1,r=void 0;try{for(var o,u=t[Symbol.iterator]();!(e=(o=u.next()).done);e=!0){if("mutate"===o.value.type)return a}}catch(t){n=!0,r=t}finally{try{!e&&u.return&&u.return()}finally{if(n)throw r}}return i};function g(s,t,e){var r=2<arguments.length&&void 0!==e?e:function(){},l={index:0,result:t(),id:m("q"),items:[],add:function(t,e){this.items.push({type:t,func:e,name:e.map(d.getFuncName)})},process:function(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];var a=l.items,c=function(){return l.items=[]};function f(){return l.index++,l.index<a.length?n():(r(l),l.result)}function n(){var t=a[l.index],e=t.type,n=t.func;switch(e){case"pipe":var r=(n[0]||function(){}).apply(void 0,[l.result].concat(i));return(0,d.isPromise)(r)?r.then(f):f();case"map":return l.result=(n[0]||function(t){return t}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(t){return l.result=t,f()}):f();case"mapToKey":return l.result=function(t){return function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},n[0],t)}.apply(void 0,[l.result].concat(i)),f();case"mutate":return l.result=(n[0]||function(t,e){return e}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(t){return l.result=t,s(l.result),f()}):(s(l.result),f());case"filter":var o=n[0].apply(n,[l.result].concat(i));return(0,d.isPromise)(o)?o.then(function(t){return t||(l.index=a.length),f()}):(o||(l.index=a.length),f());case"parallel":l.result=n.map(function(t){return t.apply(void 0,[l.result].concat(i))});var u=l.result.filter(d.isPromise);return 0<u.length?Promise.all(u).then(function(){return l.result.forEach(function(t,e){(0,d.isPromise)(t)&&t.then(function(t){return l.result[e]=t})}),f()}):f();case"cancel":return l.index=-1,c(),l.result}throw new Error('Unsupported method "'+e+'".')}return(l.index=0)<a.length?n():l.result},cancel:function(){this.items=[]}};return l}function c(t){var e=t,c={},f=[],s=[],l=!0;function d(){return function(){0<arguments.length?c.set(arguments.length<=0?void 0:arguments[0]):c.__triggerListeners()}}function y(t,e,n){function o(){if(!1===l)return c.get();var r=g(c.set,c.get,function(n){return f=f.filter(function(t){var e=t.id;return n.id!==e})});return f.push(r),o.__itemsToCreate.forEach(function(t){var e=t.type,n=t.func;return r.add(e,n)}),r.process.apply(r,arguments)}function r(t,o,u){v.forEach(function(r){t[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return y([].concat(p(i),[{type:r,func:e}]),u,o)}})}var i=0<arguments.length&&void 0!==t?t:[],u=e,a=2<arguments.length&&void 0!==n?n:null;return o.id=m("t"),o.stream=d(),o.__rineTrigger=!0,o.__itemsToCreate=[].concat(p(i)),o.__state=c,o.__activity=function(){return h(o.__itemsToCreate)},r(o,o,u),r(o.stream,o,!0),["set","get","teardown"].forEach(function(t){o[t]=function(){throw new Error('"'+t+'" is not a queue method but a method of the state object.')}}),o.test=function(t){var r=y([].concat(p(i)),u,o),n={setValue:function(t){r.__itemsToCreate=[{type:"map",func:[function(){return t}]}].concat(p(r.__itemsToCreate))},swap:function(t,e,n){Array.isArray(e)||(e=[e]),r.__itemsToCreate[t].func=e,n&&(r.__itemsToCreate[t].type=n)},swapFirst:function(t,e){n.swap(0,t,e)},swapLast:function(t,e){n.swap(r.__itemsToCreate.length-1,t,e)}};return t(n),r},u&&(s.push(o),a&&function(t){var e=t.id;s=s.filter(function(t){return t.id!==e})}(a)),o}function n(t,o){v.forEach(function(r){t[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return y([{type:r,func:e}],o)}})}return c.id=m("s"),c.__rine=!0,c.__triggerListeners=function(){return s.forEach(function(t){return t()})},c.__listeners=function(){return s},c.__queues=function(){return f},c.active=function(){return l},c.get=function(){return e},c.set=function(t){e=t,1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||c.__triggerListeners()},c.teardown=function(){f.forEach(function(t){return t.cancel()}),f=[],l=!(s=[])},c.stream=d(),n(c),n(c.stream,!0),c}},{"./utils":5}],5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isPromise=function(t){return t&&"function"==typeof t.then},n.getFuncName=function(t){if(t.name)return t.name;var e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:"unknown"}},{}]},{},[1])(1)});