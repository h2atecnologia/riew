!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Rine=t()}}(function(){return function o(i,c,a){function f(e,t){if(!c[e]){if(!i[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(s)return s(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var u=c[e]={exports:{}};i[e][0].call(u.exports,function(t){return f(i[e][1][t]||t)},u,u.exports,o,i,c,a)}return c[e].exports}for(var s="function"==typeof require&&require,t=0;t<a.length;t++)f(a[t]);return f}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.react=n.compose=n.merge=n.state=void 0;var r,u=t("./state"),o=t("./react"),i=(r=o)&&r.__esModule?r:{default:r},c=t("./utils");n.state=u.createState,n.merge=u.mergeStates,n.compose=c.compose,n.react={routine:i.default}},{"./react":2,"./state":4,"./utils":6}],2:[function(r,t,u){(function(t){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var d=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,u=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){u=!0,o=t}finally{try{!r&&c.return&&c.return()}finally{if(u)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};u.default=function(f){function e(t){var e=(0,p.useState)(null),n=d(e,2),r=n[0],u=n[1],o=(0,p.useState)({content:null,done:function(){}}),i=d(o,2),c=i[0],a=i[1];return(0,p.useEffect)(function(){r&&r.update(t)},[t]),(0,p.useEffect)(function(){r&&c.done()},[c]),(0,p.useEffect)(function(){return r=(0,m.default)(f,function(t,e){a(null===t?{content:null,done:e}:{content:y.default.createElement(s,t),done:e})}),null!==l&&r.withState(l),u(r),r.in(t),function(){r.out()}},[]),c.content}var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null},l=null;return e.displayName="Routine("+(0,n.getFuncName)(f)+")",e.withState=function(t){return l=t,e},e};var p="undefined"!=typeof window?window.React:void 0!==t?t.React:null,y=e(p),n=r("../utils"),m=e(r("../routine"));function e(t){return t&&t.__esModule?t:{default:t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../routine":3,"../utils":6}],3:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0});var v="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)},h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n.default=function(e,t){void 0===t&&(t=e,e=b);var n={},r=!1,u=[],o=null,i=null,c=null,a=b,f=(0,_.createState)({}),s=f.mutate(function(t,e){return h({},t,e)}),l=(0,_.createState)({}),d=l.mutate(function(t,e){return h({},t,e)});function p(){return r}function y(){t(f.get(),a),a=b}function m(t,e){if(null===t||void 0!==t&&"object"!==(void 0===t?"undefined":v(t)))throw new Error("The routine's \""+e+'" method must be called with a key-value object. Instead "'+t+'" passed.')}return n.__states=function(){return i},n.__triggers=function(){return c},n.isActive=p,n.in=function(t){return r=!0,m(t,"in"),d(t),null!==o&&Object.keys(o).forEach(function(e){null===i&&(i={}),null===c&&(c={});var t=(0,_.isRineState)(o[e]),n=(0,_.isRineQueueTrigger)(o[e]),r=void 0;t?(r=o[e],s(g({},e,r.get())),r.stream.pipe(function(t){return s(g({},e,t))}),i[e]=r):n?(c[e]=o[e],o[e].__state.stream.pipe(y),s(g({},e,c[e]))):(r=(0,_.createState)(o[e]),u.push(r.teardown),s(g({},e,r.get())),r.stream.pipe(function(t){return s(g({},e,t))}),i[e]=r)}),e(Object.assign({render:function(e){return m(e,"render"),r?new Promise(function(t){a=t,s(e)}):Promise.resolve()},props:l,isActive:p},null!==i?h({},i,c):{})),l.stream(),f.stream.pipe(y),y(),n},n.update=d,n.out=function(){return u.forEach(function(t){return t()}),u=[],f.teardown(),i=null,r=!1,n},n.withState=function(t){return o=t,n},n};var _=t("./state");function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b=function(){}},{"./state":4}],4:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)};n.createState=a,n.mergeStates=function(n){function t(){return Object.keys(n).reduce(function(t,e){return t[e]=n[e].get(),t},{})}var r=a(t());return r.set=function(e){if("object"!==(void 0===e?"undefined":u(e)))throw new Error("Wrong merged state value. Must be key-value pairs.");Object.keys(e).forEach(function(t){n[t].set(e[t],!1)}),r.__triggerListeners()},r.get=t,Object.keys(n).forEach(function(t){n[t].stream.pipe(function(){r.__triggerListeners()})}),r},n.createStream=function(t){return a(t).stream},n.isRineState=function(t){return t&&!0===t.__rine},n.isRineQueueTrigger=function(t){return t&&!0===t.__rineTrigger};var o,d=t("./utils"),i=t("./system");(o=i)&&o.__esModule;function p(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var c=0,y=function(t){return"@@"+t+ ++c},m=["pipe","map","mutate","filter","parallel","cancel","mapToKey"];function v(s,t,e){var r=2<arguments.length&&void 0!==e?e:function(){},l={index:0,result:t(),id:y("q"),items:[],add:function(t,e){this.items.push({type:t,func:e,name:e.map(d.getFuncName)})},process:function(){for(var t=arguments.length,i=Array(t),e=0;e<t;e++)i[e]=arguments[e];var c=l.items,a=function(){return l.items=[]};function f(){return l.index++,l.index<c.length?n():(r(l),l.result)}function n(){var t=c[l.index],e=t.type,n=t.func;switch(e){case"pipe":var r=(n[0]||function(){}).apply(void 0,[l.result].concat(i));return(0,d.isPromise)(r)?r.then(f):f();case"map":return l.result=(n[0]||function(t){return t}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(t){return l.result=t,f()}):f();case"mapToKey":return l.result=function(t){return function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},n[0],t)}.apply(void 0,[l.result].concat(i)),f();case"mutate":return l.result=(n[0]||function(t,e){return e}).apply(void 0,[l.result].concat(i)),(0,d.isPromise)(l.result)?l.result.then(function(t){return l.result=t,s(l.result),f()}):(s(l.result),f());case"filter":var u=n[0].apply(n,[l.result].concat(i));return(0,d.isPromise)(u)?u.then(function(t){return t||(l.index=c.length),f()}):(u||(l.index=c.length),f());case"parallel":l.result=n.map(function(t){return t.apply(void 0,[l.result].concat(i))});var o=l.result.filter(d.isPromise);return 0<o.length?Promise.all(o).then(function(){return l.result.forEach(function(t,e){(0,d.isPromise)(t)&&t.then(function(t){return l.result[e]=t})}),f()}):f();case"cancel":return l.index=-1,a(),l.result}throw new Error('Unsupported method "'+e+'".')}return(l.index=0)<c.length?n():l.result},cancel:function(){this.items=[]}};return l}function a(t){var e=t,a={},f=[],s=[],l=!0;function d(){return function(){0<arguments.length?a.set(arguments.length<=0?void 0:arguments[0]):a.__triggerListeners()}}function n(t,u){function c(t,e,n){function u(){if(!1===l)return a.get();var r=v(a.set,a.get,function(n){return f=f.filter(function(t){var e=t.id;return n.id!==e})});return f.push(r),u.__itemsToCreate.forEach(function(t){var e=t.type,n=t.func;return r.add(e,n)}),r.process.apply(r,arguments)}var o=0<arguments.length&&void 0!==t?t:[],i=e,r=2<arguments.length&&void 0!==n?n:null;return u.id=y("t"),u.stream=d(),u.__rineTrigger=!0,u.__itemsToCreate=[].concat(p(o)),u.__state=a,m.forEach(function(r){u[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return c([].concat(p(o),[{type:r,func:e}]),i,u)},u.stream[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return c([].concat(p(o),[{type:r,func:e}]),!0,u)}}),["set","get","teardown"].forEach(function(t){u[t]=function(){throw new Error('"'+t+'" is not a queue method but a method of the state object.')}}),u.test=function(t){var r=c([].concat(p(o)),i,u),n={setValue:function(t){r.__itemsToCreate=[{type:"map",func:[function(){return t}]}].concat(p(r.__itemsToCreate))},swap:function(t,e,n){Array.isArray(e)||(e=[e]),r.__itemsToCreate[t].func=e,n&&(r.__itemsToCreate[t].type=n)},swapFirst:function(t,e){n.swap(0,t,e)},swapLast:function(t,e){n.swap(r.__itemsToCreate.length-1,t,e)}};return t(n),r},i&&(s.push(u),r&&function(t){var e=t.id;s=s.filter(function(t){return t.id!==e})}(r)),u}m.forEach(function(r){t[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return c([{type:r,func:e}],u)}})}return a.__rine=!0,a.id=y("s"),a.__triggerListeners=function(){return s.forEach(function(t){return t()})},a.__listeners=function(){return s},a.__queues=function(){return f},a.active=function(){return l},a.get=function(){return e},a.set=function(t){e=t,1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||a.__triggerListeners()},a.teardown=function(){f.forEach(function(t){return t.cancel()}),f=[],l=!(s=[])},a.stream=d(),n(a),n(a.stream,!0),a}},{"./system":5,"./utils":6}],5:[function(t,e,n){"use strict";function r(t){return{value:t.__get(),queues:t.__queues().map(function(t){return{index:t.index,result:t.result,items:t.items.map(function(t){var e=t.type;return t.name.join(",")+"("+e+")"})}})}}Object.defineProperty(n,"__esModule",{value:!0});var u={__states:[],onStateCreated:function(t){this.__states.push(t)},onStateTeardown:function(e){this.__states=this.__states.filter(function(t){return t.id===e.id})},snapshot:function(){return this.__states.map(r)}};n.default=u},{}],6:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.isPromise=function(t){return t&&"function"==typeof t.then},n.getFuncName=function(t){if(t.name)return t.name;var e=/^function\s+([\w\$]+)\s*\(/.exec(t.toString());return e?e[1]:"unknown"},n.compose=function(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];return function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.forEach(function(t){return t.apply(void 0,e)})}}},{}]},{},[1])(1)});